<!DOCTYPE html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="kidozh的一些想法和随手笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="kidozh">
<meta property="og:url" content="https://kidozh.github.io/page/6/index.html">
<meta property="og:site_name" content="kidozh">
<meta property="og:description" content="kidozh的一些想法和随手笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kidozh">
<meta name="twitter:description" content="kidozh的一些想法和随手笔记">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://kidozh.github.io/page/6/"/>





  <title>kidozh</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">kidozh</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">某不科学的kidozh</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/04/08/abc-e7-ae-80-e5-8d-95-e8-af-81-e6-98-8e-e5-85-b6-e6-9c-80-e5-a4-a7-e5-80-bc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/08/abc-e7-ae-80-e5-8d-95-e8-af-81-e6-98-8e-e5-85-b6-e6-9c-80-e5-a4-a7-e5-80-bc/" itemprop="url">[A^B%C]简单证明其最大值</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-08T00:11:34+08:00">
                2016-04-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="命题"><a href="#命题" class="headerlink" title="命题"></a>命题</h1><p>给定( A,B,x \in N )，问( A^{x}modB )的最大值。</p>
<h1 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h1><h2 id="欧拉定理"><a href="#欧拉定理" class="headerlink" title="欧拉定理"></a>欧拉定理</h2><p>欧拉定理的一个结论。</p>
<h2 id="费马小定理"><a href="#费马小定理" class="headerlink" title="费马小定理"></a>费马小定理</h2><p>这个比较麻烦，也是欧拉定理的一个特殊情况。</p>
<p>首先假定(A=Bx+y , x,y \in N)，则</p>
<p>[ A^{z} = (Bx+y)^{2} ]</p>
<p>通过二项式展开，并且已知( c*B^{x} \% B \equiv 0 , x \geq 1)</p>
<p>则可以知道的是( (y^{x} \% B)<em>{max} \equiv (A^{x} \% B)</em>{max} )，且y，B互质</p>
<p>由<a href="http://baike.baidu.com/link?url=xy6MQ_LENwJkiYsfmdxG_5WirCzF5OPW9Htbewlr9Dhw-oJk-IETz6VziBiL_Tv-sdta5idSG2sSYRY3DANHma" target="_blank" rel="external">费马小定理</a>( y^(B-1)\% B \equiv 1 )，则令( f(x) = y^{x}%B )，则有</p>
<p>( f(0) = 1 )  ( f(B-1) = 1 )</p>
<p>这里使用数学归纳法即可证明出其具有循环节，并且循环节为( B )。</p>
<p>更严格的从<a href="http://baike.baidu.com/link?url=-wOLB4YDOO5rJuJeTyxLKpuduwDLwuTp5RjflCQKd_6vX3X8nm96-ZvNViZdbAx5g7cMgtK0nF9gDWDvqBrHJa#2_1" target="_blank" rel="external">欧拉定理</a>出发，这里的循环节准确的来讲是( \phi{B} )。</p>
<p>而这里由于求出欧拉函数( \phi{B} )较为繁琐，所以还是使用时间复杂度为( O(n) )的算法。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>很简单，就是直接对B循环内的进行一次遍历即可。</p>
<h2 id="源代码（C-）"><a href="#源代码（C-）" class="headerlink" title="源代码（C++）"></a>源代码（C++）</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> max(a, b)  (((a) &gt; (b)) ? (a) : (b))</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> a,b,res;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> n;</div><div class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;a,&amp;b))&#123;</div><div class="line">        n = <span class="number">1</span>;</div><div class="line">        res = <span class="number">-1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;b;i++)&#123;</div><div class="line">            res = max(res,n%b);</div><div class="line">            n = n*a;<span class="comment">// first mi</span></div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 这里可以使用空间换时间的方法先计算出( \phi{B} )来降低循环次数，例如：A = 10,B =12时，</p>
<p>此时( \phi{B}=4 )，所以只要计算4次，而不是12次就可以得到结果了。</p>
<h2 id="源代码（Python）"><a href="#源代码（Python）" class="headerlink" title="源代码（Python）"></a>源代码（Python）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">__author__ = <span class="string">'kidozh'</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line">a = raw_input(<span class="string">"A"</span>)</div><div class="line">b = raw_input(<span class="string">"B"</span>)</div><div class="line">a = int(a)</div><div class="line">b = int(b)</div><div class="line">res = <span class="number">0</span></div><div class="line">caculate = <span class="number">1</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,a):</div><div class="line">    res = max(res,caculate%b)</div><div class="line">    caculate *=a</div><div class="line"><span class="keyword">print</span> res</div></pre></td></tr></table></figure>
<p> 也可以使用numpy加速计算，这里就不演示了。。。</p>
<h1 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h1><p>有什么问题欢迎评论区指正！</p>
<p>还有就是欧拉定理真是无孔不入。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/03/30/ansys-e7-bb-8f-e5-85-b8-e7-95-8c-e9-9d-a2-e7-9a-84-e6-8e-a5-e8-a7-a6-e5-88-86-e6-9e-90-e4-be-8b-e5-ad-90-e5-b9-b2-e6-b6-89-e9-85-8d-e5-90-88-e5-ad-94-e8-be-b9-e7-9a-84-e5-ba-94-e5-8a-9b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/30/ansys-e7-bb-8f-e5-85-b8-e7-95-8c-e9-9d-a2-e7-9a-84-e6-8e-a5-e8-a7-a6-e5-88-86-e6-9e-90-e4-be-8b-e5-ad-90-e5-b9-b2-e6-b6-89-e9-85-8d-e5-90-88-e5-ad-94-e8-be-b9-e7-9a-84-e5-ba-94-e5-8a-9b/" itemprop="url">[ANSYS] 经典界面的接触分析例子 – 干涉配合孔边的应力分布</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-30T23:12:23+08:00">
                2016-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机械/" itemprop="url" rel="index">
                    <span itemprop="name">机械</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>一个钢销插在一个钢块中的光滑销孔中。已知钢销的半径是0.5 units, 长是2.5 units，而钢块的宽是4 Units, 长4 Units,高为1 Units,方块中的销孔半径为0.49 units,是一个通孔。钢块与钢销的弹性模量均为36e6，泊松比为0.3.</p>
<p>由于钢销的直径比销孔的直径要大，所以它们之间是过盈配合。现在要对该问题进行两个载荷步的仿真。</p>
<p>（1）要得到过盈配合的应力。</p>
<p>（2）要求当把钢销从方块中拔出时，应力，接触压力及约束力。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcibM29e&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS1.png" alt=""></a></p>
<h1 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h1><p>由于该问题关于两个坐标面对称，因此只需要取出四分之一进行分析即可。</p>
<p>进行该分析，需要两个载荷步：</p>
<p>第一个载荷步，过盈配合。求解没有附加位移约束的问题，钢销由于它的几何尺寸被销孔所约束，由于有过盈配合，因而产生了应力。</p>
<p>第二个载荷步，拔出分析。往外拉动钢销1.7 units，对于耦合节点上使用位移条件。打开自动时间步长以保证求解收敛。在后处理中每10个载荷子步读一个结果。</p>
<p>本篇先谈第一个载荷步的计算。下篇再谈第二个载荷步的计算。</p>
<h1 id="读入几何体"><a href="#读入几何体" class="headerlink" title="读入几何体"></a>读入几何体</h1><p>首先打开ANSYS APDL14.5.</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcoui67a&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS2.png" alt=""></a></p>
<p>然后读入已经做好的几何体。</p>
<p>从【工具菜单】–&gt;【File】–&gt;【Read Input From】打开导入文件对话框</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVctA060e&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS3.png" alt=""></a></p>
<p>找到ANSYS自带的文件</p>
<p>\Program Files\Ansys Inc\V145\ANSYS\data\models\block.inp</p>
<p>【OK】后四分之一几何模型被导入。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcxnIA80&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS4.png" alt=""></a></p>
<h1 id="定义单元类型"><a href="#定义单元类型" class="headerlink" title="定义单元类型"></a>定义单元类型</h1><p>只定义实体单元的类型SOLID185。至于接触单元，将在下面使用接触向导来定义。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcArSRf5&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS5.png" alt=""></a></p>
<h1 id="定义材料属性"><a href="#定义材料属性" class="headerlink" title="定义材料属性"></a>定义材料属性</h1><p>只有线弹性材料属性：弹性模量36E6和泊松比0.3</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcFpFUa2&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS6.png" alt=""></a></p>
<h1 id="划分网格"><a href="#划分网格" class="headerlink" title="划分网格"></a>划分网格</h1><p>打开MESH TOOL,先设定关键地方的网格划分份数</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcLr8i56&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS7.png" alt=""></a></p>
<p>然后在MESH TOOL中设定对两个体均进行扫略划分</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVcO3Jve1&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS8.png" alt=""></a></p>
<p>按下【Sweep】按钮，在主窗口中选择两个体，进行网格划分。则结果如下</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVd5MNX21&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS9.png" alt=""></a></p>
<p>然后创建接触单元。</p>
<p>从主菜单的下列地方点击 contact  pair，即创建接触对。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdbPP745&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS10.png" alt=""></a></p>
<p>则弹出了接触管理器</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdhypw9e&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS11.png" alt=""></a></p>
<p>点击上图中红色框内的按钮，它是接触向导。则弹出一个对话框如下</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdp80Pfb&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS12.png" alt=""></a></p>
<p>该对话框是接触向导帮助用户创建接触的第一步，它问我们，请问目标面是哪些？它们是什么类型的接触面？点击上图中的【pick target】，就是说，我们即将在主窗口中用鼠标来选择目标面。</p>
<p>在本例子中，目标面就是销孔的四分之一孔面。因此用鼠标在图中选择该面</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdyG4H2b&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS13.png" alt=""></a></p>
<p>选中后，在接触向导中按下【Next】，则弹出下面的对话框</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdJRuT57&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS14.png" alt=""></a></p>
<p>该对话框进一步要选择接触面，这里是钢销的四分之一圆柱面，同样，点击上图中的【pick contact】，然后在主窗口中选择该面如下</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdNf2aaa&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS15.png" alt=""></a></p>
<p>选中后，在接触向导中按下【Next】，则弹出下面的对话框，它要进一步设置该接触对的属性，请注意红色框内的选择。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVdSvHdb3&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS16.png" alt=""></a></p>
<p>这里，包含了初始的渗透，使用的是1号材料，摩擦系数是0.2，然后还要按下按钮【optional settings。。。】</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVe79N650&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS17.png" alt=""></a></p>
<p>在弹出来的接触属性设置中，首先在BASIC页中设置法向惩罚刚度因子为0.1,然后点击friction页，</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVebTLt83&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS18.png" alt=""></a></p>
<p>在这里，设置刚度矩阵是非对称阵。然后点击【OK】，则关闭该接触属性设置对话框，又回到了前面的接触向导对话框。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVeVkqQ88&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS19.png" alt=""></a></p>
<p>在该对话框中，点击【Create】,则接触对被创立。弹出来一个对话框</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVf187b65&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS20.png" alt=""></a></p>
<p>其意义是说，该接触对已经创建好了，你如果想使用该接触对的话，那么请使用编号3的实常数集。</p>
<p>此时，如果再次打开单元类型对话框，会发现里面多了两种单元。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVflN93dd&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS21.png" alt=""></a></p>
<p>即：TARGE170是目标单元，它覆盖在销孔内表面；CONTA174是接触单元，它覆盖在钢销外表面。</p>
<h1 id="设置边界条件"><a href="#设置边界条件" class="headerlink" title="设置边界条件"></a>设置边界条件</h1><p>首先，改变对象的查看方式，用面的方式来查看对象，从而方便设置边界条件。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVfxigXeb&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS22.png" alt=""></a></p>
<p>然后，设置对称边界条件。从主菜单的下列地方找到设置边界条件的地方</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVfN58w2c&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS23.png" alt=""></a></p>
<p>其含义是，要对几个面设置对称边界条件。然后用鼠标在主窗口中选择以下几个面</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVfTAUx19&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS24.png" alt=""></a></p>
<p>则对称边界条件被设置好，主窗口中显示如下</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgnMVf85&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS25.png" alt=""></a></p>
<p>可见，在这几个面上到处都是S，S就是对称（Symmetry）的首字母，意味着这些面被设置为对称边界了。</p>
<p>然后还要固定钢块的一个面，从下列地方找到固定面的入口</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgqBejdb&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS26.png" alt=""></a></p>
<p>然后在主窗口中找到该面</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgzh81bd&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS27.png" alt=""></a></p>
<p>选择完毕后弹出一个对话框，它问，对于该面上的所有节点，你希望固定这些节点的哪几个自由度呢？</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgCQn7d9&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS28.png" alt=""></a></p>
<p>这里选择ALL DOF，然后在下面的位移值中设置为0，就是说，该面上的所有节点，不要有任何位移。【ok】然后确认选择。如果我们变换一下视角如下</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgIIm347&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS29.png" alt=""></a></p>
<p>就会发现该面上有几个三角符号，意味着该面上的所有节点都已经被固定了。</p>
<h1 id="进行求解设置"><a href="#进行求解设置" class="headerlink" title="进行求解设置"></a>进行求解设置</h1><p>从下列菜单进入，选择SOL’N CONTROLS，即设置求解控制选项，这是进行求解设置的主要入口</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgLL6e66&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS30.png" alt=""></a></p>
<p>在弹出的对话框中设置如下</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgR1mD77&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS31.png" alt=""></a></p>
<pre><code>意思是，打开大变形开关，关闭自动时间步长，并设置该载荷步结束时的时间是100，只有一个载荷子步。
</code></pre><p>然后进行求解。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgVZwxad&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS32.png" alt=""></a></p>
<h1 id="后处理"><a href="#后处理" class="headerlink" title="后处理"></a>后处理</h1><p>进入后处理，查看Von Mises应力云图。从下图进入查看应力结果</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVgYAVS54&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS33.png" alt=""></a></p>
<p>在弹出的对话框中选择二查看Von Mises应力</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVh7rCo30&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS34.png" alt=""></a></p>
<p>【OK】后主窗口显示如下图</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVhcY0z63&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS35.png" alt=""></a></p>
<p>可见，在接触处应力最大，越往外层，应力越来越小。这与实际情况是一致的。</p>
<p>仍旧从这里进入，以查看接触处的情况</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVhuDyFc1&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS36.png" alt=""></a></p>
<p>可以看到，红色框内提供一系列选项，查看接触状态，渗透情况，接触压力，摩擦应力，总应力，滑动距离，间隙距离等等。</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVhByj8b2&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS37.png" alt=""></a></p>
<p>下面是接触处的渗透图</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVhIlgi96&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS38.png" alt=""></a></p>
<p>可见，最大渗透量是0.003226.</p>
<p>下图是接触压力</p>
<p><a href="http://photo.blog.sina.com.cn/list/blogpic.php?pid=002TvzhFzy6JNVhQhXDc5&amp;bid=9e19c10b0101kyjz&amp;uid=2652487947" target="_blank" rel="external"><img src="/wp-content/uploads/2016/03/033016_1510_ANSYS39.png" alt=""></a></p>
<p>最后，存盘为file.db。</p>
<h1 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h1><p>[playlist type=”video” ids=”1000”]</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/03/29/ansysflexlm-e6-97-a0-e6-b3-95-e5-90-af-e5-8a-a8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/29/ansysflexlm-e6-97-a0-e6-b3-95-e5-90-af-e5-8a-a8/" itemprop="url">[ANSYS]FLEXlm无法启动</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-29T17:41:56+08:00">
                2016-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机械/" itemprop="url" rel="index">
                    <span itemprop="name">机械</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在我们使用ANSYS Workbench的时候，经常会碰到证书服务的鬼畜问题，尤其是安装了UG NX之后，这个问题更为严重，因为他们的证书文件往往会占用同一个端口，这样就导致两者不可兼得。这篇博客意在说明当这种情况发生的时候我们可以怎样操作来使得FLEXlm启动。</p>
<h1 id="问题的来源"><a href="#问题的来源" class="headerlink" title="问题的来源"></a>问题的来源</h1><h2 id="license的问题"><a href="#license的问题" class="headerlink" title="license的问题"></a>license的问题</h2><p>license里面server后面的hostname和物理地址一定要与电脑本身的匹配，也就是说物理地址一定要是本地连接下面的Physical address才行。如果你的电脑开了蓝牙，无线网等，都各自会有一个对应的physical address，但是默认生成的license会采用第一个，不管这个是不是本地连接下面的。所以在生成license后，一定亲自检查，如果不对，手动修改即可。查看物理地址命令：ipconfig/all。安装ansys，记住填写hostname的时候，一定填自己的计算机名（曾见过有人写的自己的名字），如果错了，在ansys client licensing 里面启动Client ANSLIC_ADMIN utility 修改即可。</p>
<h2 id="中文路径"><a href="#中文路径" class="headerlink" title="中文路径"></a>中文路径</h2><p>安装的时候必须英文路径（国外的软件，不管是什么软件，安装一般最好都采用英文路径）。</p>
<h2 id="端口冲突"><a href="#端口冲突" class="headerlink" title="端口冲突"></a>端口冲突</h2><p>FLEXlm not running，很有可能就是端口冲突，这个以前发现过，有的软件就会互相冲突。解决办法：在dos界面下输入<code>netstat -a -o</code></p>
<p>找到<strong>1055</strong>端口对应pid值，然后启动任务管理器，打开“查看-选项列”，勾选pid选项，找到pid值对应的映像名称，结束进程；打开打开Server ANSLIC_ADMIN Utility ， 点击stop the ANSYS,lnc.License Manager,再点击start the ANSYS,lnc.License Manager，看看FLEXlm是不是变成running了点击start the ANSYS,lnc.License Manager，看看FLEXlm是不是变成running了。这里由于UG的证书文件往往和这货端口号一致，所以经常鬼畜。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/03/25/e5-9b-9e-e8-a5-bf-e5-ae-89-e6-9c-89-e6-84-9f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/25/e5-9b-9e-e8-a5-bf-e5-ae-89-e6-9c-89-e6-84-9f/" itemprop="url">回西安有感</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-25T18:17:10+08:00">
                2016-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂谈/" itemprop="url" rel="index">
                    <span itemprop="name">杂谈</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>时间还是不争气的走到了今天，列车到站西安北一直在我的耳边萦绕，两旁的风景大踏步的远离我的双眼，就好像我和故乡的饯别一般矫健。依然沉浸在汉川的春节中，我一直没意识到接下来的一年之中，分离总是主旋律，沉溺于不可多得的团圆气氛中有点类似于精神胜利法。那么现在自然是立flag时间了：</p>
<ol>
<li>下学期多撸书少扣手机</li>
<li>写一个基于python的查重包</li>
<li>蹭一下日语</li>
<li>交流答辩能够通过</li>
<li>把机器学习的那本书干掉</li>
<li>好好锻炼身体，作息规律<br>好了，以后博客大概就是疯狂的出现上面的几件事情了。。。<br>新学期就这样奔跑吧！</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/02/24/e6-96-b0-e5-ad-a6-e5-b9-b4-e5-bc-80-e5-a7-8b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/02/24/e6-96-b0-e5-ad-a6-e5-b9-b4-e5-bc-80-e5-a7-8b/" itemprop="url">新学年开始</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-24T00:16:17+08:00">
                2016-02-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂谈/" itemprop="url" rel="index">
                    <span itemprop="name">杂谈</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>元宵随着二中的烟火弥散进无形的空气里，春节和着阳春的小曲戛然而止。在梦幻一般的假期过后，空气中重新浸润着忙碌的气息，于是，新的一年也就这样裹挟着种种可能和生机，想少年时候的我扒开礼物盒一样，迫不及待的剥掉时光永不磨灭的古老的外壳。就这样一直奔跑吧，我的2016。祝大家新年新气象！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/02/02/django-e5-85-83-e9-80-89-e9-a1-b9-e5-8f-82-e8-80-83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/02/02/django-e5-85-83-e9-80-89-e9-a1-b9-e5-8f-82-e8-80-83/" itemprop="url">[Django]元选项参考</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-02T19:16:26+08:00">
                2016-02-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模型元选项"><a href="#模型元选项" class="headerlink" title="模型元选项"></a>模型元选项</h1><p>这篇文档阐述了所有可用的元选项，你可以在你模型的Meta类中设置他们。</p>
<h1 id="可用的元选项"><a href="#可用的元选项" class="headerlink" title="可用的元选项"></a>可用的元选项</h1><h2 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h2><p><code>Options.abstract</code></p>
<p>如果 <code>abstract = True</code>， 就表示模型是 抽象基类 (abstract base class).</p>
<h2 id="app-label"><a href="#app-label" class="headerlink" title="app_label"></a>app_label</h2><p><code>Options.app_label</code></p>
<p>如果一个模型位于标准的位置之外（应用的models.py 或models 包），该模型必须定义它属于哪个应用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app_label = <span class="string">'myapp'</span></div></pre></td></tr></table></figure></p>
<p><strong>New in Django 1.7:</strong></p>
<p>定义在应用的models 模块以外的模型，不再需要app_label。</p>
<h2 id="db-table"><a href="#db-table" class="headerlink" title="db_table"></a>db_table</h2><p><code>Options.db_table</code></p>
<p>该模型所用的数据表的名称：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db_table = <span class="string">'music_album'</span></div></pre></td></tr></table></figure></p>
<h3 id="数据表名称"><a href="#数据表名称" class="headerlink" title="数据表名称"></a>数据表名称</h3><p>为节省你的时间，Django 会根据模型类的名称和包含它的应用的名称自动指定数据库表名称。一个模型的数据库表名称，由这个模型的“应用标签”（在<code>manage.py startapp</code>中使用的名称）和模型类名称之间加上下划线组成。</p>
<p>举个例子，  bookstore应用(使用  <code>manage.py startapp bookstore</code> 创建)，里面有个名为 Book的模型，那数据表的名称就是  bookstore_book 。</p>
<p>使用 Meta类中的 <code>db_table</code> 参数来重写数据表的名称。</p>
<p>数据表名称可以是 <code>SQL</code> 保留字，也可以包含不允许出现在 Python 变量中的特殊字符，这是因为 Django 会自动给列名和表名添加引号。</p>
<h4 id="在-MySQL中使用小写字母为表命名"><a href="#在-MySQL中使用小写字母为表命名" class="headerlink" title="在 MySQL中使用小写字母为表命名"></a>在 MySQL中使用小写字母为表命名</h4><p>当你通过<code>db_table</code>覆写表名称时，强烈推荐使用小写字母给表命名，特别是如果你用了MySQL作为后端。详见MySQL注意事项 。</p>
<h4 id="Oracle中表名称的引号处理"><a href="#Oracle中表名称的引号处理" class="headerlink" title="Oracle中表名称的引号处理"></a>Oracle中表名称的引号处理</h4><p>为了遵从<code>Oracle</code>中30个字符的限制，以及一些常见的约定，Django会缩短表的名称，而且会把它全部转为大写。在db_table的值外面加上引号来避免这种情况：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db_table = <span class="string">'"name_left_in_lowercase"'</span></div></pre></td></tr></table></figure></p>
<p> 这种带引号的名称也可以用于Django所支持的其他数据库后端，但是除了Oracle，引号不起任何作用。详见 Oracle 注意事项 。</p>
<h2 id="db-tablespace"><a href="#db-tablespace" class="headerlink" title="db_tablespace"></a>db_tablespace</h2><p><code>Options.db_tablespace</code></p>
<p>当前模型所使用的数据库表空间 的名字。默认值是项目设置中的DEFAULT_TABLESPACE，如果它存在的话。如果后端并不支持表空间，这个选项可以忽略。</p>
<h2 id="default-related-name"><a href="#default-related-name" class="headerlink" title="default_related_name"></a>default_related_name</h2><p><code>Options.default_related_name</code></p>
<p><strong>New in Django 1.8.</strong></p>
<p>这个名字会默认被用于一个关联对象到当前对象的关系。默认为 <code>&lt;model_name&gt;_set</code>。</p>
<p>由于一个字段的反转名称应该是唯一的，当你给你的模型设计子类时，要格外小心。为了规避名称冲突，名称的一部分应该含有’<code>%(app_label)s</code>‘和’<code>%(model_name)s</code>‘，它们会被应用标签的名称和模型的名称替换，二者都是小写的。详见抽象模型的关联名称。</p>
<h2 id="get-latest-by"><a href="#get-latest-by" class="headerlink" title="get_latest_by"></a>get_latest_by</h2><p><code>Options.get_latest_by</code></p>
<p>模型中某个可排序的字段的名称，比如<code>DateField</code>、<code>DateTimeField</code>或者<code>IntegerField</code>。它指定了Manager的<code>latest()</code>和<code>earliest()</code>中使用的默认字段。</p>
<p>例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">get_latest_by = <span class="string">"order_date"</span></div></pre></td></tr></table></figure></p>
<p> 详见<code>latest()</code>文档。</p>
<h2 id="managed"><a href="#managed" class="headerlink" title="managed"></a>managed</h2><p><code>Options.managed</code></p>
<p>默认为<code>True</code>，意思是Django在<code>migrate</code>命令中创建合适的数据表，并且会在 <code>flush</code> 管理命令中移除它们。换句话说，Django会管理这些数据表的生命周期。</p>
<p>如果是False，Django 就不会为当前模型创建和删除数据表。如果当前模型表示一个已经存在的，通过其它方法建立的数据库视图或者数据表，这会相当有用。这是设置为<code>managed=False</code>时唯一的不同之处。. 模型处理的其它任何方面都和平常一样。这包括：</p>
<ol>
<li>如果你不声明它的话，会向你的模型中添加一个自增主键。为了避免给后面的代码读者带来混乱，强烈推荐你在使用未被管理的模型时，指定数据表中所有的列。</li>
<li>如果一个带有<code>managed=False</code>的模型含有指向其他未被管理模型的<code>ManyToManyField</code>，那么多对多连接的中介表也不会被创建。但是，一个被管理模型和一个未被管理模型之间的中介表会被创建。</li>
</ol>
<p>如果你需要修改这一默认行为，创建中介表作为显式的模型（设置为managed），并且使用<code>ManyToManyField.through</code>为你的自定义模型创建关联。</p>
<p>对于带有<code>managed=False</code>的模型的测试，你要确保在测试启动时建立正确的表。</p>
<p>如果你对修改模型类在Python层面的行为感兴趣，你可以设置 <code>managed=False</code> ，并且为一个已经存在的模型创建一个副本。但是这种情况下使用代理模型才是更好的方法。</p>
<h2 id="order-with-respect-to"><a href="#order-with-respect-to" class="headerlink" title="order_with_respect_to"></a>order_with_respect_to</h2><p><code>Options.order_with_respect_to</code></p>
<p>按照给定的字段把这个对象标记为”可排序的“。这一属性通常用到关联对象上面，使它在父对象中有序。比如，如果Answer和 Question相关联，一个问题有至少一个答案，并且答案的顺序非常重要，你可以这样做：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></div><div class="line">    text = models.TextField()</div><div class="line">    <span class="comment"># ...</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Answer</span><span class="params">(models.Model)</span>:</span></div><div class="line">    question = models.ForeignKey(Question)</div><div class="line">    <span class="comment"># ...</span></div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        order_with_respect_to = <span class="string">'question'</span></div></pre></td></tr></table></figure></p>
<p> 当<tt><code>order_with_respect_to</code></tt> 设置之后，模型会提供两个用于设置和获取关联对象顺序的方法：<tt><code>get_RELATED_order()</code></tt> 和<tt><code>set_RELATED_order()</code></tt>，其中<tt><code>RELATED</code></tt>是小写的模型名称。例如，假设一个 <tt>Question</tt> 对象有很多相关联的<tt>Answer</tt>对象，返回的列表中含有相关联<tt>Answer</tt>对象的主键：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; question = Question.objects.get(id=1)</div><div class="line">&gt;&gt;&gt; question.get_answer_order()</div><div class="line">[1, 2, 3]</div></pre></td></tr></table></figure></p>
<p> 与Question对象相关联的Answer对象的顺序，可以通过传入一格包含Answer 主键的列表来设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; question.set_answer_order([3, 1, 2])</div></pre></td></tr></table></figure></p>
<p> 相关联的对象也有两个方法， <code>get_next_in_order()</code> 和<code>get_previous_in_order()</code>，用于按照合适的顺序访问它们。假设Answer对象按照 id来排序：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; answer = Answer.objects.get(id=2)</div><div class="line">&gt;&gt;&gt; answer.get_next_in_order()</div><div class="line">&lt;Answer: 3&gt;</div><div class="line">&gt;&gt;&gt; answer.get_previous_in_order()</div><div class="line">&lt;Answer: 1&gt;</div></pre></td></tr></table></figure></p>
<p> 修改 <code>order_with_respect_to</code></p>
<p><code>order_with_respect_to</code>属性会添加一个额外的字段（/数据表中的列）叫做<code>_order</code>，所以如果你在首次迁移之后添加或者修改了<code>order_with_respect_to</code>属性，要确保执行和应用了合适的迁移操作。</p>
<h2 id="ordering"><a href="#ordering" class="headerlink" title="ordering"></a>ordering</h2><p><code>Options.ordering</code></p>
<p>对象默认的顺序，获取一个对象的列表时使用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ordering = [<span class="string">'-order_date'</span>]</div></pre></td></tr></table></figure></p>
<p>它是一个字符串的列表或元组。每个字符串是一个字段名，前面带有可选的“-”前缀表示倒序。前面没有“-”的字段表示正序。使用”?”来表示随机排序。</p>
<p>例如，要按照pub_date字段的正序排序，这样写：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ordering = [<span class="string">'pub_date'</span>]</div></pre></td></tr></table></figure></p>
<p>按照pub_date字段的倒序排序，这样写：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ordering = [<span class="string">'-pub_date'</span>]</div></pre></td></tr></table></figure></p>
<p>先按照pub_date的倒序排序，再按照 author 的正序排序，这样写：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ordering = [<span class="string">'-pub_date'</span>, <span class="string">'author'</span>]</div></pre></td></tr></table></figure></p>
<p><strong>警告</strong></p>
<p>排序并不是没有任何代价的操作。你向ordering属性添加的每个字段都会产生你数据库的开销。你添加的每个外键也会隐式包含它的默认顺序。</p>
<h2 id="permissions"><a href="#permissions" class="headerlink" title="permissions"></a>permissions</h2><p><code>Options.permissions</code></p>
<p>设置创建对象时权限表中额外的权限。增加、删除和修改权限会自动为每个模型创建。这个例子指定了一种额外的权限，<code>can_deliver_pizzas</code>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">permissions = ((<span class="string">"can_deliver_pizzas"</span>, <span class="string">"Can deliver pizzas"</span>),)</div></pre></td></tr></table></figure></p>
<p>它是一个包含二元组的元组或者列表，格式为 (permission_code, human_readable_permission_name)。</p>
<h3 id="default-permissions"><a href="#default-permissions" class="headerlink" title="default_permissions"></a>default_permissions</h3><p><code>Options.default_permissions</code></p>
<p><strong>New in Django 1.7.</strong></p>
<p>默认为(‘add’, ‘change’, ‘delete’)。你可以自定义这个列表，比如，如果你的应用不需要默认权限中的任何一项，可以把它设置成空列表。在模型被migrate命令创建之前，这个属性必须被指定，以防一些遗漏的属性被创建。</p>
<h2 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h2><p><code>Options.proxy</code></p>
<p>如果<code>proxy = True</code>, 作为该模型子类的另一个模型会被视为代理模型。</p>
<h3 id="select-on-save"><a href="#select-on-save" class="headerlink" title="select_on_save"></a>select_on_save</h3><p><code>Options.select_on_save</code></p>
<p>该选项决定了Django是否采用1.6之前的 <code>django.db.models.Model.save()</code>算法。旧的算法使用<code>SELECT</code>来判断是否存在需要更新的行。而新式的算法直接尝试使用 UPDATE。在一些小概率的情况中，一个已存在的行的<code>UPDATE</code>操作并不对Django可见。比如PostgreSQL的<code>ON UPDATE</code>触发器会返回<code>NULL</code>。这种情况下，新式的算法会在最后执行 <code>INSERT</code> 操作，即使这一行已经在数据库中存在。</p>
<p>通常这个属性不需要设置。默认为<code>False</code>。</p>
<p>关于旧式和新式两种算法，请参见<code>django.db.models.Model.save()</code>。</p>
<h3 id="unique-together"><a href="#unique-together" class="headerlink" title="unique_together"></a>unique_together</h3><p><code>Options.unique_together</code></p>
<p>用来设置的不重复的字段组合：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unique_together = ((<span class="string">"driver"</span>, <span class="string">"restaurant"</span>),)</div></pre></td></tr></table></figure></p>
<p>它是一个元组的元组，组合起来的时候必须是唯一的。它在Django后台中被使用，在数据库层上约束数据(比如，在  <code>CREATE TABLE</code>  语句中包含  UNIQUE语句)。</p>
<p>为了方便起见，处理单一字段的集合时，<code>unique_together</code> 可以是一维的元组：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unique_together = (<span class="string">"driver"</span>, <span class="string">"restaurant"</span>)</div></pre></td></tr></table></figure></p>
<p><code>ManyToManyField</code>不能包含在<code>unique_together</code>中。（这意味着什么并不清楚！）如果你需要验证<code>ManyToManyField</code>关联的唯一性，试着使用信号或者显式的贯穿模型(<code>explicit through model</code>)。</p>
<p><strong>Changed in Django 1.7:</strong></p>
<p>当<code>unique_together</code>的约束被违反时，模型校验期间会抛出<code>ValidationError</code>异常。</p>
<h2 id="index-together"><a href="#index-together" class="headerlink" title="index_together"></a>index_together</h2><p><code>Options.index_together</code></p>
<p>用来设置带有索引的字段组合：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">index_together = [</div><div class="line"></div><div class="line">    [<span class="string">"pub_date"</span>, <span class="string">"deadline"</span>],</div><div class="line"></div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>列表中的字段将会建立索引（例如，会在<code>CREATE INDEX</code>语句中被使用）。</p>
<p><strong>Changed in Django 1.7.</strong></p>
<p>为了方便起见，处理单一字段的集合时，index_together可以是一个一维的列表。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index_together = [<span class="string">"pub_date"</span>, <span class="string">"deadline"</span>]</div></pre></td></tr></table></figure></p>
<h2 id="verbose-name"><a href="#verbose-name" class="headerlink" title="verbose_name"></a>verbose_name</h2><p><code>Options.verbose_name</code></p>
<p>对象的一个易于理解的名称，为单数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">verbose_name = <span class="string">"pizza"</span></div></pre></td></tr></table></figure></p>
<p>如果此项没有设置，Django会把类名拆分开来作为自述名，比如CamelCase 会变成camel case，</p>
<h3 id="verbose-name-plural"><a href="#verbose-name-plural" class="headerlink" title="verbose_name_plural"></a>verbose_name_plural</h3><p><code>Options.verbose_name_plural</code></p>
<p>该对象复数形式的名称：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">verbose_name_plural = <span class="string">"stories"</span></div></pre></td></tr></table></figure></p>
<p>如果此项没有设置，Django 会使用 <code>verbose_name + &quot;s&quot;</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/02/01/django-e6-a8-a1-e5-9e-8b-e5-ad-97-e6-ae-b5-e5-8f-82-e8-80-83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/02/01/django-e6-a8-a1-e5-9e-8b-e5-ad-97-e6-ae-b5-e5-8f-82-e8-80-83/" itemprop="url">[Django]模型字段参考</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-01T17:30:09+08:00">
                2016-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文档包含了Django提供的全部模型字段的字段选项 和 字段类型的API参考。</p>
<p>如果内建的字段不能满足你的需要，你可以尝试对特定国家和文化有效的包含配套代码的 <a href="https://django-localflavor.readthedocs.org/" target="_blank" rel="external">django-localflavor</a>。当然，你也可以很容易的编写你自定义的字段。</p>
<p>严格意义上来讲， model 是定义在<code>django.db.models.fields</code>里面，但为了使用方便，它们被导入到 <code>django.db.models</code>中；标准上，我们导入from django.db import models ，然后使用 <code>models.&lt;Foo&gt;Field</code>的形式使用字段。</p>
<h1 id="字段选项"><a href="#字段选项" class="headerlink" title="字段选项"></a>字段选项</h1><p>下列参数是全部字段类型都可用的，都是可选的。</p>
<h2 id="null"><a href="#null" class="headerlink" title="null"></a>null</h2><p><code>Field.null</code></p>
<p>如果为<code>True</code>，Django 将空值以<code>NULL</code> 存储到数据库中。默认值是 <code>False</code>。</p>
<p>字符串字段例如<code>CharField</code> 和<code>TextField</code> 要避免使用<code>null</code>，因为空字符串值将始终储存为空字符串而不是<code>NULL</code>。如果字符串字段的<code>null=True</code>，那意味着对于“无数据”有两个可能的值：<code>NULL</code> 和空字符串。在大多数情况下，对于“无数据”声明两个值是赘余的，Django 的惯例是使用空字符串而不是<code>NULL</code>。</p>
<p>无论是字符串字段还是非字符串字段，如果你希望在表单中允许空值，你将还需要设置<code>blank=True</code>，因为null 仅仅影响数据库存储（参见<a href="http://python.usyiyi.cn/django_182/ref/models/fields.html#django.db.models.Field.blank" target="_blank" rel="external">blank</a>）。</p>
<p>注意：</p>
<p>在使用Oracle 数据库时，数据库将存储<code>NULL</code> 来表示空字符串，而与这个属性无关。</p>
<p>如果你希望<code>BooleanField</code> 接受null 值，请用 <code>NullBooleanField</code> 代替。</p>
<h2 id="blank"><a href="#blank" class="headerlink" title="blank"></a>blank</h2><p><code>Field.blank</code></p>
<p>如果为<code>True</code>，则该字段允许为空白。 默认值是 <code>False</code>。</p>
<p>注意它与<code>null</code>不同。<code>null</code> 纯粹是数据库范畴的概念，而<code>blank</code> 是数据验证范畴的。如果字段设置<code>blank=True</code>，表单验证时将允许输入空值。如果字段设置<code>blank=False</code>，则该字段为必填。</p>
<h2 id="choices"><a href="#choices" class="headerlink" title="choices"></a>choices</h2><p><code>Field.choices</code></p>
<p>它是一个可迭代的结构(比如，列表或是元组)，由可迭代的二元组组成(比如[(A, B), (A, B) …] )，用来给这个字段提供选择项。如果设置了 <code>choices</code> ，默认表格样式就会显示选择框，而不是标准的文本框，而且这个选择框的选项就是 <code>choices</code> 中的元组。</p>
<p>每个元组中的第一个元素，是存储在数据库中的值；第二个元素是该选项更易理解的描述。 比如:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">YEAR_IN_SCHOOL_CHOICES = (</div><div class="line">    (<span class="string">'FR'</span>, <span class="string">'Freshman'</span>),</div><div class="line">    (<span class="string">'SO'</span>, <span class="string">'Sophomore'</span>),</div><div class="line">    (<span class="string">'JR'</span>, <span class="string">'Junior'</span>),</div><div class="line">    (<span class="string">'SR'</span>, <span class="string">'Senior'</span>),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p> 一般来说，最好在模型类内部定义<code>choices</code>，然后再给每个值定义一个合适名字的常量。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></div><div class="line">    FRESHMAN = <span class="string">'FR'</span></div><div class="line">    SOPHOMORE = <span class="string">'SO'</span></div><div class="line">    JUNIOR = <span class="string">'JR'</span></div><div class="line">    SENIOR = <span class="string">'SR'</span></div><div class="line">    YEAR_IN_SCHOOL_CHOICES = (</div><div class="line">        (FRESHMAN, <span class="string">'Freshman'</span>),</div><div class="line">        (SOPHOMORE, <span class="string">'Sophomore'</span>),</div><div class="line">        (JUNIOR, <span class="string">'Junior'</span>),</div><div class="line">        (SENIOR, <span class="string">'Senior'</span>),</div><div class="line">    )</div><div class="line">    year_in_school = models.CharField(max_length=<span class="number">2</span>,</div><div class="line">                                      choices=YEAR_IN_SCHOOL_CHOICES,</div><div class="line">                                      default=FRESHMAN)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_upperclass</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.year_in_school <span class="keyword">in</span> (self.JUNIOR, self.SENIOR)</div></pre></td></tr></table></figure></p>
<p> 尽管你可以在模型类的外部定义choices然后引用它，在模型类中定义choices和其每个<code>choice</code>的name可以保存所有的关于应用到此信息的类的信息， 也使得choices更容易被应用（例如， <code>Student.SOPHOMORE</code> 可以在任何引入Student 模型的位置生效)。</p>
<p>你也可以归类可选的<code>choices</code>到已命名的组中用来达成组织整理的目的:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">MEDIA_CHOICES = (</div><div class="line">    (<span class="string">'Audio'</span>, (</div><div class="line">            (<span class="string">'vinyl'</span>, <span class="string">'Vinyl'</span>),</div><div class="line">            (<span class="string">'cd'</span>, <span class="string">'CD'</span>),</div><div class="line">        )</div><div class="line">    ),</div><div class="line">    (<span class="string">'Video'</span>, (</div><div class="line">            (<span class="string">'vhs'</span>, <span class="string">'VHS Tape'</span>),</div><div class="line">            (<span class="string">'dvd'</span>, <span class="string">'DVD'</span>),</div><div class="line">        )</div><div class="line">    ),</div><div class="line">    (<span class="string">'unknown'</span>, <span class="string">'Unknown'</span>),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p> 每个元组的第一个元素是组的名字。第二个元素是一组可迭代的二元元组，每一个二元元组包含一个值和一个给人看的名字构成一个选项。分组的选项可能会和未分组的选项合在同一个<code>list</code>中。 （就像例中的<code>unknown</code>选项）。</p>
<p>对于每个有choices set的模型字段, Django 将会加入一个通过该字段现在的值取回给人看的名字的方法。参见数据库API文档中的<code>get_FOO_display()</code>。</p>
<p>请注意<code>choices</code>可以是任何可迭代的对象 – 不是必须是列表或者元组。这一点使你可以动态的构建<code>choices</code>。但是如果你发现你自己搞不定动态的<code>choices</code>，你最好还是使用<code>ForeignKey</code>来构建一个合适的数据库表。<code>choices</code>意味着那些变动不多的静态数据，如果有的（变动）话。</p>
<p>除非字段中默认了<code>blank=False</code>，那么<code>---------</code>就会在选择框中被渲染出来。你也可以向元祖中添加一个包含<code>None</code>的<code>choices</code>来覆盖这个行为（比如：<code>(None, &#39;Your String For Display&#39;)</code>）。</p>
<h2 id="db-column"><a href="#db-column" class="headerlink" title="db_column"></a>db_column</h2><p><code>Field.db_column</code></p>
<p>数据库中用来表征该字段的名称。如果未指定，那么Django将会使用<code>Field</code>名作为字段名.</p>
<p>如果你的数据库列名为SQL语句的保留字，或者是包含不能作为Python 变量名的字符，很明显地如连字符，仍然可以的。Django 会在后台给列名和表名加上双引号。</p>
<h2 id="db-index"><a href="#db-index" class="headerlink" title="db_index"></a>db_index</h2><p><code>Field.db_index</code></p>
<p>若值为 <code>True</code>, 则 <code>django-admin sqlindexes</code> 将会为此字段输出 <code>CREATE INDEX</code> 语句。（译注：为此字段创建索引）</p>
<h2 id="db-tablespace"><a href="#db-tablespace" class="headerlink" title="db_tablespace"></a>db_tablespace</h2><p><code>Field.db_tablespace</code></p>
<p>如果该字段有索引的话，<code>database tablespace</code>的名称用作该字段的索引。 如果<code>DEFAULT_INDEX_TABLESPACE</code> 已经设置，则默认值是由<code>DEFAULT_INDEX_TABLESPACE</code>指定, 如果没有设置则由 <code>db_tablespace</code> 指定。如果后台数据库不支持表空间，或者索引，则该选项被忽略。</p>
<h2 id="default"><a href="#default" class="headerlink" title="default"></a>default</h2><p><code>Field.default</code></p>
<p>该字段的默认值. 它可以是一个值或者一个可调用对象. 如果是一个可调用对象，那么在每一次创建新对象的时候，它将会调用一次.</p>
<p>这个默认值不可以是一个可变对象（如字典，列表，等等）,因为对于所有模型的一个新的实例来说，它们指向同一个引用。或者，把他们包装为一个可调用的对象。例如，你有一个自定义的<code>JSONField</code>，并且想指定一个特定的字典值，可以如下使用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">contact_default</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> &#123;<span class="string">"email"</span>: <span class="string">"to1@example.com"</span>&#125;</div><div class="line"></div><div class="line">contact_info = JSONField(<span class="string">"ContactInfo"</span>, default=contact_default)</div></pre></td></tr></table></figure></p>
<p> 请注意<code>lambdas</code> 函数不可作为如 <code>default</code> 这类可选参数的值.因为它们无法被 <code>migrations</code>命令序列化. 请参见文档其他部分。</p>
<p>默认值会在新实例创建并且没有给该字段提供值时使用。如果字段为主键，默认值也会在设置为
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/02/01/django-e6-a8-a1-e5-9e-8b-e5-ad-97-e6-ae-b5-e5-8f-82-e8-80-83/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/01/28/e9-9a-8f-e4-be-bf-e4-b8-80-e4-be-83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/28/e9-9a-8f-e4-be-bf-e4-b8-80-e4-be-83/" itemprop="url">随便一侃</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-28T07:10:23+08:00">
                2016-01-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂谈/" itemprop="url" rel="index">
                    <span itemprop="name">杂谈</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>时间的日历终于耷拉着脸走到了今天，我的情绪始终都没法从前日的事情中缓过劲来，仿佛还陷入在愤怒的沼泽里。</p>
<p>我也不知道为什么提到高中的那份暧昧会让现在的我如此羞愧，也许是高中三年繁重的学业压的我不愿意回首，也许是中考惨淡的成绩的伤口仍然浸渍着不断涌出的鲜血令我休克，更也许是我对于未来苍白承诺的流亡。回想我大学三年，我也觉得我逐渐的在改变着自己，变得市侩而庸俗，变得精致而胆怯，就好像一个大牛说的那样，往往你觉得精心搭建的蜘蛛网，可能在大风过后，什么都不剩。的确，现在的环境无时无刻不在提醒我，我只是一个茕茕孑立的旅客，我一无所有，我给予不了任何人承诺，我既无法像留驻本省的同学那样按照自己的意志自由的呼吸生活的芬芳，也窒息于漫天散开的陌生和寂寞。每当我抬头仰望这片夜空的时候，我会下意识的去寻找星星，但星星总会刺痛我的眼睛。每当我觉得很冒犯的事情发生的时候，好像我除了挤出我惯有的礼貌以外走投无路。于是我变得所谓的温和，所谓的合群。除了平常和南方的同学吐槽种种无奈之外，我竟找不到第二种能够安慰我的方法。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/01/28/charlescharles-e4-bd-bf-e7-94-a8-e6-95-99-e7-a8-8b-e6-8c-87-e5-8d-97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/28/charlescharles-e4-bd-bf-e7-94-a8-e6-95-99-e7-a8-8b-e6-8c-87-e5-8d-97/" itemprop="url">[Charles]charles使用教程指南</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-28T01:07:12+08:00">
                2016-01-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全工程/" itemprop="url" rel="index">
                    <span itemprop="name">安全工程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Charles是一款抓包修改工具，相比起burp，charles具有界面简单直观，易于上手，数据请求控制容易，修改简单，抓取数据的开始暂停方便等等优势！下面来详细介绍下这款强大好用的抓包工具。</p>
<h1 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h1><p>首先是工具下载和安装 首先需要下载java的运行环境支持（一般用burp的人肯定也都有装java环境）。装好java环境后，可以直接去百度搜索并下载charles的破解版，下载到破解版之后，里面一般会有注册的jar文件，然后注册后就可以永久使用了（ps：不注册的话，每次使用30分钟，工具就会自动关闭）。</p>
<h1 id="PC端抓包"><a href="#PC端抓包" class="headerlink" title="PC端抓包"></a>PC端抓包</h1><p>下面是pc端的抓包使用情况 Charles支持抓去http、https协议的请求，不支持socket。</p>
<p>然后charles会自动配置IE浏览器和工具的代理设置，所以说打开工具直接就已经是抓包状态了。 这里打开百度抓包下，工具界面和相关基础功能如下图所示：</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar1.jpg" alt=""></p>
<p>上图中的7个位置是最常用的几个功能。</p>
<p>1 那个垃圾桶图标，功能是clear，清理掉所有请求显示信息。</p>
<p>2 那个望远镜图标，功能是搜索关键字，也可以使用ctrl+f实现，可以设置搜索的范围。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar2.jpg" alt=""></p>
<p>3 圆圈中间红点的图标，功能是领抓去的数据显示或者不显示的设置。 这个本人认为是charles工具很方便的一个两点，一般都使其为不显示抓去状态，只有当自己测试的时候的前后，在令其为抓取并显示状态。这样可以快准狠的获取到相关自己想要的信息，而不必在一堆数据请求中去寻找。</p>
<p>4 编辑修改功能，可以编辑修改任意请求信息，修改完毕后点击Execute就可以发送一个修改后的请求数据包。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar3.jpg" alt=""></p>
<p>5 抓取的数据包的请求地址的url信息显示。</p>
<p>6 抓取的数据包的请求内容的信息显示。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar4.jpg" alt=""></p>
<p>post请求可以显示form形式，直观明了。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar5.jpg" alt=""></p>
<p>7 返回数据内容信息的显示。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar6.jpg" alt=""></p>
<p>其中5、6、7中都有各种形式的数据显示形式，其中raw是原始数据包的状态。</p>
<h1 id="显示模式"><a href="#显示模式" class="headerlink" title="显示模式"></a>显示模式</h1><p>charles抓包的显示，支持两种模式，Structure和Sequence，其优点分别如下。</p>
<p>Structure形式如下图 优点：可以很清晰的看到请求的数据结构，而且是以域名划分请求信息的，可以很清晰的去分析和处理数据。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar7.jpg" alt=""></p>
<p>Sequence形式如下图 优点：可以很清晰的看到全部请求，不用一层一层的去点开，这里是以数据请求的顺序去执行的，也就是说那个请求快就在前面显示。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar8.jpg" alt=""></p>
<p>具体要说两种形式哪个更好，这个就是见仁见智了。本人比较喜欢第二种，粗矿豪放！</p>
<h1 id="移动APP抓包"><a href="#移动APP抓包" class="headerlink" title="移动APP抓包"></a>移动APP抓包</h1><p>这里相比其他抓包软件来说要简单的多了，具体步骤如下：</p>
<p>1 使手机和电脑在一个局域网内，不一定非要是一个ip段，只要是同一个漏油器下就可以了，比如电脑连接的有线网ip为192.168.16.12，然后手机链接的wifi ip为192.168.1.103，但是这个有线网和无线网的最终都是来自于一个外部ip，这样的话也是可以的。</p>
<p>2 下面说说具体配置，这里电脑端是不用做任何配置的，但是需要把防火墙关掉（这点很重要）！</p>
<p>然后charles设置需要设置下允许接收的ip地址的范围。 设置首先要进入这个位置 Proxy - Access Control Settings 然后如果接收的ip范围是192.168.1.xxx的话，那么就添加并设置成192.168.1.0/24 如果全部范围都接收的话，那么就直接设置成0.0.0.0/0</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar9.jpg" alt=""></p>
<p>然后如果勾选了Proxy - Windows Proxy 的话，那么就会将电脑上的抓包请求也抓取到，如果只抓手机的话，可以将这个设置为不勾选。</p>
<p>3 接下来下面是手机端的配置</p>
<p>首先利用cmd - ipconfig命令查看自己电脑的ip地址</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar10.jpg" alt=""></p>
<p>然后在手机端的wifi代理设置那里去进行相关的配置设置。</p>
<p>这里的代理服务器地址填写为电脑的ip地址，然后端口这里写8888（这个是charles的默认设置），如果自己修改了就写成自己所修改的端口就可以了。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar11.jpg" alt=""></p>
<p>4 好了，这样就配置完成就大功告成了！下面打开UC浏览器或者其他东西，随便访问个网页看有没有抓取到数据就可以了（我这里是直接访问的新浪新闻首页）。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar12.jpg" alt=""></p>
<h1 id="其他常用功能"><a href="#其他常用功能" class="headerlink" title="其他常用功能"></a>其他常用功能</h1><p>相信上面介绍的那些你已经学会了吧，下面再说说charles的一些其他常用的功能</p>
<p>选择请求后，右键可以看到一些常用的功能，这里说说Repeat 就是重复发包一次。 然后Advanced Repeat就是重复发包多次，这个功能用来测试短信轰炸漏洞很方便。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar13.jpg" alt=""></p>
<p>还有比如说修改referer测试CSRF漏洞，修改form内容测试XSS，修改关键的参数测试越权，修改url、form、cookie等信息测试注入等，都非常方便。</p>
<p>好了，这款工具的介绍就到这里了，相信这款方便好用的工具，以后肯定会被更多的人使用到的。</p>
<h1 id="charles使用问题汇总"><a href="#charles使用问题汇总" class="headerlink" title="charles使用问题汇总"></a>charles使用问题汇总</h1><p>Charles是一款很好用的抓包修改工具，但是如果你不是很熟悉这个工具的话，肯定会遇到各种感觉很莫名其妙的状况，这里就来帮你一一解答。</p>
<p>1 为什么下载了不能用啊？打不开啊。</p>
<p>因为charles是需要java环境才能运行的，需要先安装java环境才可以。</p>
<p>2 为什么我用着用着就自动关闭了？大概30分钟就会关闭一次。</p>
<p>因为charles如果没有注册的话，每次打开后就只能哟个30分钟，然后就会自动关闭，所以最好在使用前先按照说明去进行工具的注册操作。</p>
<p>3 为什么我在操作的时候有时候就直接工具就界面卡住死了，关都关不掉，只能用任务管理器才可以关掉？</p>
<p>这个的确是charles这个工具的一个bug，开始用的时候，我也很恶心，而且经常悲剧，但是现在也有相应的解决办法了，下面那样操作就可以了。</p>
<p>首先随便抓些包，要求有图片的请求。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar14.jpg" alt=""></p>
<p>然后选中一个图片的请求，然后分别点击 Response - Raw 然后那里会加载其中的内容，然后加载完毕后，再去随便操作就可以了，就不会在悲剧的直接工具卡死掉了。。。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar15.jpg" alt=""></p>
<p>4 为什么用了charles后，我就上不了网页了，但是qq可以。</p>
<p>因为如果charles是非正常状态下关闭的话，那么IE的代理就不会被自动取消，所以会导致这种情况。</p>
<p>解决办法：</p>
<p>第一种：直接打开charles，然后再正常关闭即可。 第二种：去将IE浏览器代理位置的勾选去掉。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar16.jpg" alt=""></p>
<p>5 为什么我用charles不能抓到socket和https的数据呢？</p>
<p>首先，charles是不支持抓去socket数据的。 然后，如果抓不到https的数据的话，请查看你是不是没有勾选ssl功能。 Proxy - Proxy Settings - SSL 设置</p>
<p>6 为什么我用charles抓取手机APP，什么都是配置正确的，但是却抓不到数据。</p>
<p>首先，请确保电脑的防火墙是关闭状态，这个很重要。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar17.jpg" alt=""></p>
<p>如果，防火墙关了还是不行，那么请把手机wifi断掉后重新连接，这样一般就可以解决问题了。 如果以上方法还是不行的话，那么请将手机wifi位置的ip地址设置成静态ip，然后重启charles工具。</p>
<p>7 抓包后发现form中有些数据显示是乱码怎么办？</p>
<p>请在Raw模式下查看，Raw模式显示的是原始数据包，一般不会因为编码问题导致显示为乱码。</p>
<p>8 我用charles抓手机app的数据，但是同时也会抓去到电脑端的数据，可以设置吗？</p>
<p>可以，设置位置在Proxy - Windows Proxy ，勾选表示接收电脑的数据抓包，如果只想抓去APP的数据请求，可以不勾选此功能。</p>
<p>9 为什么我用IE可以抓到数据，但是用360或者谷歌浏览器就不行？</p>
<p>请确保360或者谷歌的代码设置中是不是勾选设置的是 使用IE代理。</p>
<p><img src="/wp-content/uploads/2016/01/012716_1706_Charleschar18.jpg" alt=""></p>
<p>10 想要复制粘贴某些数据的话，怎么办，右键没有相应功能啊？</p>
<p>请直接使用Ctrl +C 和 Ctrl+V 即可。</p>
<p>以上就是charles在使用过程中常见的10中问题和相应的解决情况，有了这个文章，大家就不用在遇到问题的时候懊恼了，嘿嘿。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kidozh.github.io/2016/01/26/djangomodel-e4-bb-8b-e7-bb-8d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kido zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kidozh">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/26/djangomodel-e4-bb-8b-e7-bb-8d/" itemprop="url">[Django]Model介绍</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-26T20:09:36+08:00">
                2016-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>模型系统是一种精准的描述你信息的来源。其包含了一些必要的数据以及其操作行为，通常来说，一个模型就是一个单独的数据库中的表。</p>
<p>其中模型系统最基础的是：</p>
<ul>
<li>每个模型都包含了一个Python的子类<code>django.db.models.Model</code>的一个类</li>
<li>每个模型中的属性都代表着一个数据库字段</li>
<li>有着这些，Django就能够赋予你自动创建的数据库API，在<a href="https://docs.djangoproject.com/en/1.9/topics/db/queries/" target="_blank" rel="external">Making Queries</a>中可以看到</li>
</ul>
<h1 id="简单的例子"><a href="#简单的例子" class="headerlink" title="简单的例子"></a>简单的例子</h1><p>这个例子定义了一个<code>Person</code>，其具有<code>first_name</code>和<code>last_name</code>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></div><div class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</div></pre></td></tr></table></figure></p>
<p> <code>first_name</code>和<code>last_name</code>都是模型之中的字段，每个字段都有一个特定的类属性所确定，每个属性都和一种特定的数据库列所对应。</p>
<p><code>Person</code>这个模型会创建这样的模型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE myapp_person (</div><div class="line">    &quot;id&quot; serial NOT NULL PRIMARY KEY,</div><div class="line">    &quot;first_name&quot; varchar(30) NOT NULL,</div><div class="line">    &quot;last_name&quot; varchar(30) NOT NULL</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p> 需要注意的是：</p>
<ul>
<li>表的名字被自动分配成<code>myapp_person</code>，这个表的名字可以从一些模型的元数据中提取，在<a href="https://docs.djangoproject.com/en/1.8/ref/models/options/#table-names" target="_blank" rel="external">Table names</a>可以获得更多信息</li>
<li>id这一列是自动添加的，但是这个操作能够被重新定义，<a href="https://docs.djangoproject.com/en/1.8/topics/db/models/#automatic-primary-key-fields" target="_blank" rel="external">Automatic primary key fields</a>中就有关于自动定义主键的信息</li>
<li><code>CREATE SQL</code>在这里面使用的SQL语句是用的PostgreSQL语法，但是还是需要指出的是Django使用的SQL语句是由你在<code>setting.py</code>中的数据库后台的设定所指定的</li>
</ul>
<h1 id="使用模型"><a href="#使用模型" class="headerlink" title="使用模型"></a>使用模型</h1><p>当你已经定义好模型之后，你需要指定Django需要使用哪些模型，通过编辑你的设置文件以及向<code>INSTALLED_APPS</code>的设定中添加包含<code>models.py</code>的模组的名字。</p>
<p>举个例子，如果你的应用的模型在<code>myapp.models</code>之下（这个包由<code>manage.py startapp</code>这个指令所生成），<code>INSTALLED_APP</code>一个是这样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">INSTALLED_APPS = (</div><div class="line">    <span class="comment">#...</span></div><div class="line">    <span class="string">'myapp'</span>,</div><div class="line">    <span class="comment">#...</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p> 当你向INSTALLED_APPS之中增加了新的应用之后，一定要确保运行了manage.py migrate，当然第一次应用模型的时候需要使用<code>manage.py makemigrations</code>。</p>
<h1 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h1><p>模型中最重要的一部分就是字段了，字段同时也是模型的一个唯一的必填项，字段有类属性所确定，但是字段的名字最好不要和<a href="https://docs.djangoproject.com/en/1.8/ref/models/instances/" target="_blank" rel="external">模型的API</a>相抵触，比如<code>clean</code>，<code>save</code>或者<code>delete</code>。</p>
<p>举个例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Musician</span><span class="params">(models.Model)</span>:</span></div><div class="line">    first_name = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    last_name = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    instrument = models.CharField(max_length=<span class="number">100</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Album</span><span class="params">(models.Model)</span>:</span></div><div class="line">    artist = models.ForeignKey(Musician)</div><div class="line">    name = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    release_date = models.DateField()</div><div class="line">    num_stars = models.IntegerField()</div></pre></td></tr></table></figure></p>
<h2 id="字段的名字"><a href="#字段的名字" class="headerlink" title="字段的名字"></a>字段的名字</h2><p>每个在你的模型中的字段都应该包含一个正确的字段的类的实例，Django会使用字段的名字来确立下列的一些事情：</p>
<ul>
<li>数据库行的类型（比如INTEGER，VARCHAR）</li>
<li>渲染表单中字段的时候默认HTML的控件样式（比如<input type="text">, <select>）</select></li>
<li>使用Django管理员的最小的验证需求</li>
</ul>
<p>Django搭载了许多的内建字段类型，你能够在<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#model-field-types" target="_blank" rel="external">模型字段参考</a>中找到完整的列表，你也可以轻松的<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#model-field-types" target="_blank" rel="external">定义</a>你的模型字段。</p>
<h2 id="字段的选项"><a href="#字段的选项" class="headerlink" title="字段的选项"></a>字段的选项</h2><p>每一个字段都会包含一些列特定的参数（<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#model-field-types" target="_blank" rel="external">模型字段参考</a>就有）。举个例子<code>CharField</code>和其子类都需要一个<code>max_length</code>的参数来指定<code>VARCHAR</code>的数据字段大小。</p>
<p>这里也有一系列常用的字段参数，所有的都是可选的，在<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#model-field-types" target="_blank" rel="external">模型字段参考</a>中有详细解释，但是我们还是在这里给出一个小结吧：</p>
<h3 id="null"><a href="#null" class="headerlink" title="null"></a>null</h3><p>如果被置为真值，Django会存储一个NULL的值，默认是假</p>
<h3 id="blank"><a href="#blank" class="headerlink" title="blank"></a>blank</h3><p>如果置为真，字段能够为空。</p>
<p>需要注意的是，这个和null和不一样，null纯粹就是和数据库关联的，而blank却是验证相关的。如果一个字段具有<code>blank=True</code>，表单验证会允许一个空值，如果一个字段具有<code>blank=False</code>，这个字段就是必填的。</p>
<h3 id="choices"><a href="#choices" class="headerlink" title="choices"></a>choices</h3><p>在这个字段里需要使用一个二元的可迭代的元祖，此时默认的HTML空间将会是一个选择框，并且会限制选项。</p>
<p>这个选择列表是这样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">YEAR_IN_SCHOOL_CHOICES = (</div><div class="line">    (<span class="string">'FR'</span>, <span class="string">'Freshman'</span>),</div><div class="line">    (<span class="string">'SO'</span>, <span class="string">'Sophomore'</span>),</div><div class="line">    (<span class="string">'JR'</span>, <span class="string">'Junior'</span>),</div><div class="line">    (<span class="string">'SR'</span>, <span class="string">'Senior'</span>),</div><div class="line">    (<span class="string">'GR'</span>, <span class="string">'Graduate'</span>),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p> 每个元祖的第一个元素就是会被存储到数据库里的值，第二个会被默认表单控件所展示。当具有一个模型对象的实例的时候，对于选项字段的显示值可以被<code>get_FOO_display</code>的方法所操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">from django.db import models</div><div class="line"></div><div class="line">class Person(models.Model):</div><div class="line">    SHIRT_SIZES = (</div><div class="line">        (&apos;S&apos;, &apos;Small&apos;),</div><div class="line">        (&apos;M&apos;, &apos;Medium&apos;),</div><div class="line">        (&apos;L&apos;, &apos;Large&apos;),</div><div class="line">    )</div><div class="line">    name = models.CharField(max_length=60)</div><div class="line">    shirt_size = models.CharField(max_length=1, choices=SHIRT_SIZES)</div><div class="line">&gt;&gt;&gt; p = Person(name=&quot;Fred Flintstone&quot;, shirt_size=&quot;L&quot;)</div><div class="line">&gt;&gt;&gt; p.save()</div><div class="line">&gt;&gt;&gt; p.shirt_size</div><div class="line">&apos;L&apos;</div><div class="line">&gt;&gt;&gt; p.get_shirt_size_display()</div><div class="line">&apos;Large&apos;</div></pre></td></tr></table></figure></p>
<h3 id="default"><a href="#default" class="headerlink" title="default"></a>default</h3><p>字段的默认值。其可以是一个数值或者一个能够被引用的对象，如果其是一个被引用的对象，当新对象被创建的时候其就能够被调用了</p>
<h3 id="help-text"><a href="#help-text" class="headerlink" title="help_text"></a>help_text</h3><p>多余的帮助文档会在表单控件之中显示，对于文档来说，其非常有用。</p>
<h3 id="primary-key"><a href="#primary-key" class="headerlink" title="primary_key"></a>primary_key</h3><p>如果为真，这个字段就是模型的一个主键了。</p>
<p>如果你没有指定primary_key=True的字段，Django会自动增加一个IntegerField的数字字段来作为主键，所以你不是一定要在某个字段之中设置primary_key=True。当然如果你需要重定义默认主键的行为的话，你就需要定义primary_key=True的字段了。关于这种行为，你可以点击<a href="https://docs.djangoproject.com/en/1.8/topics/db/models/#automatic-primary-key-fields" target="_blank" rel="external">这里</a>。</p>
<p>需要注意的是，主键是只读的，如果你变更了现有对象的主键的值然后保存了，这个新对象会在旧对象后创建：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">100</span>, primary_key=<span class="keyword">True</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fruit = Fruit.objects.create(name=<span class="string">'Apple'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fruit.name = <span class="string">'Pear'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fruit.save()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Fruit.objects.values_list(<span class="string">'name'</span>, flat=<span class="keyword">True</span>)</div><div class="line">[<span class="string">'Apple'</span>, <span class="string">'Pear'</span>]</div></pre></td></tr></table></figure></p>
<h3 id="unique"><a href="#unique" class="headerlink" title="unique"></a>unique</h3><p>如果为真，这个字段需要是独一无二的。当然，在<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#common-model-field-options" target="_blank" rel="external">这里</a>有详细解释。</p>
<h2 id="自增的字段"><a href="#自增的字段" class="headerlink" title="自增的字段"></a>自增的字段</h2><p>默认的来说，Django会给每个模型这样的模型：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id = models.AutoField(primary_key=<span class="keyword">True</span>)</div></pre></td></tr></table></figure></p>
<p> 这就是一个自增的主键了。</p>
<p>如果你想自定义一个主键，你只需要在你的字段中指定<code>primary_key=True</code>即可，如果Django观察到了你已经精准的定义了<code>Field.primary_key</code>之后，其就不会添加自增的列了。</p>
<p>每个模型的需要一个自增的字段（除非被精准的定义了或者自动增加一个主键）。</p>
<h2 id="自述字段名"><a href="#自述字段名" class="headerlink" title="自述字段名"></a>自述字段名</h2><p>每个字段的类别，除了 <code>ForeignKey</code>, <code>ManyToManyField</code> 和 <code>OneToOneField</code>都会要求一个可选的位置参数，也就是一个自述字段名字段名，如果这个字段名没有给定的话，Django就会自动使用字段的名字来创建（字段名中的下划线会被空格所取代）。</p>
<p>在这个例子中，自述字段名就是person’s first name：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">first_name = models.CharField(<span class="string">"person's first name"</span>, max_length=<span class="number">30</span>)</div></pre></td></tr></table></figure></p>
<p> 在这个例子中，自述字段名就是first name：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">first_name = models.CharField(max_length=<span class="number">30</span>)</div></pre></td></tr></table></figure></p>
<p><code>ForeignKey</code>, <code>ManyToManyField</code>和<code>OneToOneField</code>都需要一个模型类作为第一个参数，所以需要使用<code>verbose_name</code>作为一个关键字参数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">poll = models.ForeignKey(Poll, verbose_name=<span class="string">"the related poll"</span>)</div><div class="line">sites = models.ManyToManyField(Site, verbose_name=<span class="string">"list of sites"</span>)</div><div class="line">place = models.OneToOneField(Place, verbose_name=<span class="string">"related place"</span>)</div></pre></td></tr></table></figure></p>
<p> 这种规定不会确立<code>verbose_name</code>的第一个字母。当必要时，Django会自动确定第一个字母。</p>
<h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><p> 关系型数据库的特点就是表之间具有特定的关系，这里，Django提供了三种最常见的数据库关系：多对一，多对多和一对一。</p>
<h3 id="多对一关系"><a href="#多对一关系" class="headerlink" title="多对一关系"></a>多对一关系</h3><p>我们可以使用<code>django.db.models.ForeginKey</code>来定义多对一关系，你可以像其他字段一样，向类之中添加属性来使用这种数据库。</p>
<p><code>ForeignKey</code>需要一个定位参数：一个模型相关的类。</p>
<p>举个例子，对于一辆车来说只有一个制造商，但是制造商可以造很多两车，车和制造商之间就构成了多对一关系。这样就可以使用这样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manufacturer</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">(models.Model)</span>:</span></div><div class="line">    manufacturer = models.ForeignKey(Manufacturer)</div><div class="line">    <span class="comment"># ...</span></div></pre></td></tr></table></figure></p>
<p> 你也可以创建<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#recursive-relationships" target="_blank" rel="external">递归的关联关系</a>（recursive relationships，也就是一种对自己的多对一对象）和<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#lazy-relationships" target="_blank" rel="external">关联至尚未定义关系的模型</a>（relationships to models not yet defined），详情可以见<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#ref-foreignkey" target="_blank" rel="external">模型字段参考</a>。</p>
<p><code>ForeignKey</code>字段（比如例子中的制造商）应该是小写的模型名称，你可以任意的调用它。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">(models.Model)</span>:</span></div><div class="line">    company_that_makes_it = models.ForeignKey(Manufacturer)</div><div class="line">    <span class="comment"># ...</span></div></pre></td></tr></table></figure></p>
<p>同样的，<code>ForeignKey</code>字段可以接收一些额外的参数，在<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#foreign-key-arguments" target="_blank" rel="external">模型字段参考</a>中可以获得详情。这些选项能有助于定义关系工作的方式。</p>
<p>对于后台相关的对象，你可以点击<a href="https://docs.djangoproject.com/en/1.8/topics/db/queries/#backwards-related-objects" target="_blank" rel="external">这里</a>。</p>
<p>让我们来举个例子吧！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reporter</span><span class="params">(models.Model)</span>:</span></div><div class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    email = models.EmailField()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>              <span class="comment"># __unicode__ on Python 2</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"%s %s"</span> % (self.first_name, self.last_name)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></div><div class="line">    headline = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    pub_date = models.DateField()</div><div class="line">    reporter = models.ForeignKey(Reporter)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>              <span class="comment"># __unicode__ on Python 2</span></div><div class="line">        <span class="keyword">return</span> self.headline</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        ordering = (<span class="string">'headline'</span>,)</div></pre></td></tr></table></figure></p>
<p> 下面我们就给出了通过Python API的操作实例：</p>
<p>创建一些记者：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r = Reporter(first_name=&apos;John&apos;, last_name=&apos;Smith&apos;, email=&apos;john@example.com&apos;)</div><div class="line">&gt;&gt;&gt; r.save()</div><div class="line"></div><div class="line">&gt;&gt;&gt; r2 = Reporter(first_name=&apos;Paul&apos;, last_name=&apos;Jones&apos;, email=&apos;paul@example.com&apos;)</div><div class="line">&gt;&gt;&gt; r2.save()</div></pre></td></tr></table></figure></p>
<p> 创建一些文章：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from datetime import date</div><div class="line">&gt;&gt;&gt; a = Article(id=None, headline=&quot;This is a test&quot;, pub_date=date(2005, 7, 27), reporter=r)</div><div class="line">&gt;&gt;&gt; a.save()</div><div class="line"></div><div class="line">&gt;&gt;&gt; a.reporter.id</div><div class="line">1</div><div class="line"></div><div class="line">&gt;&gt;&gt; a.reporter</div><div class="line">&lt;Reporter: John Smith&gt;</div></pre></td></tr></table></figure></p>
<p> 现在你必须在其分配一个外键之前就保存这个对象，举个例子，下面就是创建一个没有保存的记者的文章，其会引发<code>ValueError</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r3 = Reporter(first_name=&apos;John&apos;, last_name=&apos;Smith&apos;, email=&apos;john@example.com&apos;)</div><div class="line">&gt;&gt;&gt; Article.objects.create(headline=&quot;This is a test&quot;, pub_date=date(2005, 7, 27), reporter=r3)</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">ValueError: save() prohibited to prevent data loss due to unsaved related object &apos;reporter&apos;.</div></pre></td></tr></table></figure></p>
<p> 需要注意的是在Django 1.8.4之前，保存一个没有关联的对象并不会引发异常，这样会引发数据丢失，在1.8-1.8.3之中，没有保存的模型实力不会分配到指定的字段，而且为了更简单使用模型，约束也会被移除。</p>
<p>文章这个对象能够这样被记者这个对象所引用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r = a.reporter</div></pre></td></tr></table></figure></p>
<p> 在Python 2里，其返回的字符是<code>str</code>而不是<code>unicode</code>的字符串。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r.first_name, r.last_name</div><div class="line">(&apos;John&apos;, &apos;Smith&apos;)</div></pre></td></tr></table></figure></p>
<p>通过记者对象来创建一个文章：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; new_article = r.article_set.create(headline=&quot;John&apos;s second story&quot;, pub_date=date(2005, 7, 29))</div><div class="line">&gt;&gt;&gt; new_article</div><div class="line">&lt;Article: John&apos;s second story&gt;</div><div class="line">&gt;&gt;&gt; new_article.reporter</div><div class="line">&lt;Reporter: John Smith&gt;</div><div class="line">&gt;&gt;&gt; new_article.reporter.id</div><div class="line">1</div></pre></td></tr></table></figure></p>
<p> 创建一个文章并且把它加到文章集里：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; new_article2 = Article(headline=&quot;Paul&apos;s story&quot;, pub_date=date(2006, 1, 17))</div><div class="line">&gt;&gt;&gt; r.article_set.add(new_article2)</div><div class="line">&gt;&gt;&gt; new_article2.reporter</div><div class="line">&lt;Reporter: John Smith&gt;</div><div class="line">&gt;&gt;&gt; new_article2.reporter.id</div><div class="line">1</div><div class="line">&gt;&gt;&gt; r.article_set.all()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: Paul&apos;s story&gt;, &lt;Article: This is a test&gt;]</div></pre></td></tr></table></figure></p>
<p> 向不同的文章集中增加相同的文章：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r2.article_set.add(new_article2)</div><div class="line">&gt;&gt;&gt; new_article2.reporter.id</div><div class="line">2</div><div class="line">&gt;&gt;&gt; new_article2.reporter</div><div class="line">&lt;Reporter: Paul Jones&gt;</div></pre></td></tr></table></figure></p>
<p> 向一个集中添加错误的对象会引发异常：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r.article_set.add(r2)</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">TypeError: &apos;Article&apos; instance expected</div><div class="line"></div><div class="line">&gt;&gt;&gt; r.article_set.all()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div><div class="line">&gt;&gt;&gt; r2.article_set.all()</div><div class="line">[&lt;Article: Paul&apos;s story&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; r.article_set.count()</div><div class="line">2</div><div class="line"></div><div class="line">&gt;&gt;&gt; r2.article_set.count()</div><div class="line">1</div></pre></td></tr></table></figure></p>
<p> 注意最后一个例子中，文章的作者已经由John变成了Paul。</p>
<p>相关的数据库也支持字段的查找，API会自动遵循你需要的关系，使用双下划线来区分关系，其能够在任意的层面进行工作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r.article_set.filter(headline__startswith=&apos;This&apos;)</div><div class="line">[&lt;Article: This is a test&gt;]</div><div class="line"></div><div class="line"># Find all Articles for any Reporter whose first name is &quot;John&quot;.</div><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__first_name=&apos;John&apos;)</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div></pre></td></tr></table></figure></p>
<p> 也支持精准匹配：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__first_name=&apos;John&apos;)</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div></pre></td></tr></table></figure></p>
<p> 也能支持相关字段的AND查询，这样会自动变成一个和情形在WHERE的语法中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__first_name=&apos;John&apos;, reporter__last_name=&apos;Smith&apos;)</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div></pre></td></tr></table></figure></p>
<p> 从相关的查询中，你可以指定一个主键或者精准的过滤掉一些相关的对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__pk=1)</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter=1)</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter=r)</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__in=[1,2]).distinct()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: Paul&apos;s story&gt;, &lt;Article: This is a test&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__in=[r,r2]).distinct()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: Paul&apos;s story&gt;, &lt;Article: This is a test&gt;]</div></pre></td></tr></table></figure></p>
<p> 你也能够使用查询集：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.filter(reporter__in=Reporter.objects.filter(first_name=&apos;John&apos;)).distinct()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div></pre></td></tr></table></figure></p>
<p> 反向查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__pk=1)</div><div class="line">[&lt;Reporter: John Smith&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article=1)</div><div class="line">[&lt;Reporter: John Smith&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article=a)</div><div class="line">[&lt;Reporter: John Smith&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__headline__startswith=&apos;This&apos;)</div><div class="line">[&lt;Reporter: John Smith&gt;, &lt;Reporter: John Smith&gt;, &lt;Reporter: John Smith&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__headline__startswith=&apos;This&apos;).distinct()</div><div class="line">[&lt;Reporter: John Smith&gt;]</div></pre></td></tr></table></figure></p>
<p> 获得符合条件对象的个数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__headline__startswith=&apos;This&apos;).count()</div><div class="line">3</div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__headline__startswith=&apos;This&apos;).distinct().count()</div><div class="line">1</div></pre></td></tr></table></figure></p>
<p> 同样也可以循环查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__reporter__first_name__startswith=&apos;John&apos;)</div><div class="line">[&lt;Reporter: John Smith&gt;, &lt;Reporter: John Smith&gt;, &lt;Reporter: John Smith&gt;, &lt;Reporter: John Smith&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__reporter__first_name__startswith=&apos;John&apos;).distinct()</div><div class="line">[&lt;Reporter: John Smith&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__reporter=r).distinct()</div><div class="line">[&lt;Reporter: John Smith&gt;]</div></pre></td></tr></table></figure></p>
<p> 如果你删除了记者，那么他的文章也会被删除（根据<code>[django.db.models.ForeignKey.on_delete](https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.ForeignKey.on_delete &quot;django.db.models.ForeignKey.on_delete&quot;)</code>在<code>ForeignKey</code>中的定义）.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.all()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: Paul&apos;s story&gt;, &lt;Article: This is a test&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.order_by(&apos;first_name&apos;)</div><div class="line">[&lt;Reporter: John Smith&gt;, &lt;Reporter: Paul Jones&gt;]</div><div class="line">&gt;&gt;&gt; r2.delete()</div><div class="line">&gt;&gt;&gt; Article.objects.all()</div><div class="line">[&lt;Article: John&apos;s second story&gt;, &lt;Article: This is a test&gt;]</div><div class="line">&gt;&gt;&gt; Reporter.objects.order_by(&apos;first_name&apos;)</div><div class="line">[&lt;Reporter: John Smith&gt;]</div></pre></td></tr></table></figure></p>
<p> 你也可以使用连接的方法构造要求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Reporter.objects.filter(article__headline__startswith=&apos;This&apos;).delete()</div><div class="line">&gt;&gt;&gt; Reporter.objects.all()</div><div class="line">[]</div><div class="line">&gt;&gt;&gt; Article.objects.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<h3 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h3><p>对于多对多关系，就可以使用<code>ManyToManyField</code>，你可以像使用其他字段一样使用它：把它包含到类里面去。</p>
<p><code>ManyToManyField</code>只要一个定位参数：关联模型的类。</p>
<p>举个例子，Pizza有很多配料，配料也可以被用在各种不同的pizza上，所以你可以这样表示他们的关系：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topping</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    toppings = models.ManyToManyField(Topping)</div></pre></td></tr></table></figure></p>
<p> 和<code>ForeignKey</code>一样，你也能创建迭代关系，还是老样子，我就不安利了。</p>
<p>这里还是建议（并非强制要求）<code>ManyToManyField</code>的名称只是纯粹描述相关模型对象的集合。</p>
<p>哪一个模型包含<code>ManyToManyField</code>，并不重要但是你应该至少把它放到其中一个里。</p>
<p>通常来说，<code>ManyToManyField</code>实例应该深入到在表单中被编辑的对象中，在上面的例子中，配料（topping）是披萨（Pizza）的一个组成部分（并不是配料具有和pizza的多对多关系）。一旦我们创建了这个模型，Pizza的表单里就会让我们选择配料了。</p>
<p>那么还是看个例子吧！</p>
<p>在这个例子之中我们会使用文章和出版者来举例说明多对多关系。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publication</span><span class="params">(models.Model)</span>:</span></div><div class="line">    title = models.CharField(max_length=<span class="number">30</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>              <span class="comment"># __unicode__ on Python 2</span></div><div class="line">        <span class="keyword">return</span> self.title</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        ordering = (<span class="string">'title'</span>,)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></div><div class="line">    headline = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    publications = models.ManyToManyField(Publication)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>              <span class="comment"># __unicode__ on Python 2</span></div><div class="line">        <span class="keyword">return</span> self.headline</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        ordering = (<span class="string">'headline'</span>,)</div></pre></td></tr></table></figure></p>
<p> 下面的操作使用的是Python 的命令行，需要注意的是你现在使用的是一个即时性的多对多关系的模型，有些相关的操作方式可能被禁用了，所以一些例子可能会不使用这个模型。</p>
<p>创建一些Publication：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p1 = Publication(title=&apos;The Python Journal&apos;)</div><div class="line">&gt;&gt;&gt; p1.save()</div><div class="line">&gt;&gt;&gt; p2 = Publication(title=&apos;Science News&apos;)</div><div class="line">&gt;&gt;&gt; p2.save()</div><div class="line">&gt;&gt;&gt; p3 = Publication(title=&apos;Science Weekly&apos;)</div><div class="line">&gt;&gt;&gt; p3.save()</div></pre></td></tr></table></figure></p>
<p> 创建一篇文章：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a1 = Article(headline=&apos;Django lets you build Web apps easily&apos;)</div></pre></td></tr></table></figure></p>
<p> 在你需要关联之前，你应该提前储存这个数据（也就是文章），如果手贱没有保存的话，那么Django就会析出ValueError了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a1.publications.add(p1)</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">ValueError: &apos;Article&apos; instance needs to have a primary key value before a many-to-many relationship can be used.</div></pre></td></tr></table></figure></p>
<p> 那么就保存吧！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a1.save()</div></pre></td></tr></table></figure></p>
<p> 把文章和发行者关联起来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a1.publications.add(p1)</div></pre></td></tr></table></figure></p>
<p> 创建其他的文章，并且添加多个Publication：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a2 = Article(headline=&apos;NASA uses Python&apos;)</div><div class="line">&gt;&gt;&gt; a2.save()</div><div class="line">&gt;&gt;&gt; a2.publications.add(p1, p2)</div><div class="line">&gt;&gt;&gt; a2.publications.add(p3)</div></pre></td></tr></table></figure></p>
<p> 重复添加也是允许的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a2.publications.add(p3)</div></pre></td></tr></table></figure></p>
<p> 而添加一个不正确的类就会析出<code>TypeError</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a2.publications.add(a1)</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">TypeError: &apos;Publication&apos; instance expected</div></pre></td></tr></table></figure></p>
<p> 创建并且向文章中增加一个Publication。如果需要一步到位，那么可以使用<code>create()</code>函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; new_publication = a2.publications.create(title=&apos;Highlights for Children&apos;)</div></pre></td></tr></table></figure></p>
<p>文章这个对象能够访问到所有相关的Publication的对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a1.publications.all()</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; a2.publications.all()</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: Science News&gt;, &lt;Publication: Science Weekly&gt;, &lt;Publication: The Python Journal&gt;]</div></pre></td></tr></table></figure></p>
<p> Publication对象可以访问到相关的Article对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[&lt;Article: NASA uses Python&gt;]</div><div class="line">&gt;&gt;&gt; p1.article_set.all()</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line">&gt;&gt;&gt; Publication.objects.get(id=4).article_set.all()</div><div class="line">[&lt;Article: NASA uses Python&gt;]</div></pre></td></tr></table></figure></p>
<p> 多对多关系可以在<a href="https://docs.djangoproject.com/en/1.8/topics/db/queries/#lookups-that-span-relationships" target="_blank" rel="external">跨关系查询</a>中获得更多信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__id=1)</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__pk=1)</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications=1)</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications=p1)</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__title__startswith=&quot;Science&quot;)</div><div class="line">[&lt;Article: NASA uses Python&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__title__startswith=&quot;Science&quot;).distinct()</div><div class="line">[&lt;Article: NASA uses Python&gt;]</div></pre></td></tr></table></figure></p>
<p> <code>count()</code>这个函数也能使用<code>distinct()</code>的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__title__startswith=&quot;Science&quot;).count()</div><div class="line">2</div><div class="line"></div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__title__startswith=&quot;Science&quot;).distinct().count()</div><div class="line">1</div><div class="line"></div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__in=[1,2]).distinct()</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.filter(publications__in=[p1,p2]).distinct()</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA uses Python&gt;]</div></pre></td></tr></table></figure></p>
<p> 反向查询也是可以使用的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Publication.objects.filter(id=1)</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; Publication.objects.filter(pk=1)</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article__headline__startswith=&quot;NASA&quot;)</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: Science News&gt;, &lt;Publication: Science Weekly&gt;, &lt;Publication: The Python Journal&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article__id=1)</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article__pk=1)</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article=1)</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article=a1)</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div><div class="line"></div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article__in=[1,2]).distinct()</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: Science News&gt;, &lt;Publication: Science Weekly&gt;, &lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; Publication.objects.filter(article__in=[a1,a2]).distinct()</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: Science News&gt;, &lt;Publication: Science Weekly&gt;, &lt;Publication: The Python Journal&gt;]</div></pre></td></tr></table></figure></p>
<p> 排除掉一些特定的项目也可以（虽然说相关的SQL语句有一点复杂。。。）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Article.objects.exclude(publications=p2)</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;]</div></pre></td></tr></table></figure></p>
<p> 当我们删除了一个Publication之后，其Article也不能访问它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p1.delete()</div><div class="line">&gt;&gt;&gt; Publication.objects.all()</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: Science News&gt;, &lt;Publication: Science Weekly&gt;]</div><div class="line">&gt;&gt;&gt; a1 = Article.objects.get(pk=1)</div><div class="line">&gt;&gt;&gt; a1.publications.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p> 如果我们删除了Article，那么也是一样的道理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a2.delete()</div><div class="line">&gt;&gt;&gt; Article.objects.all()</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;]</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p> 也可以通过其他方式来使用多对多关系：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a4 = Article(headline=&apos;NASA finds intelligent life on Earth&apos;)</div><div class="line">&gt;&gt;&gt; a4.save()</div><div class="line">&gt;&gt;&gt; p2.article_set.add(a4)</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[&lt;Article: NASA finds intelligent life on Earth&gt;]</div><div class="line">&gt;&gt;&gt; a4.publications.all()</div><div class="line">[&lt;Publication: Science News&gt;]</div></pre></td></tr></table></figure></p>
<p> 也可以使用索引的方法获取某个对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; new_article = p2.article_set.create(headline=&apos;Oxygen-free diet works wonders&apos;)</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[&lt;Article: NASA finds intelligent life on Earth&gt;, &lt;Article: Oxygen-free diet works wonders&gt;]</div><div class="line">&gt;&gt;&gt; a5 = p2.article_set.all()[1]</div><div class="line">&gt;&gt;&gt; a5.publications.all()</div><div class="line">[&lt;Publication: Science News&gt;]</div></pre></td></tr></table></figure></p>
<p> 从Article中移除一个Publication：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a4.publications.remove(p2)</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[&lt;Article: Oxygen-free diet works wonders&gt;]</div><div class="line">&gt;&gt;&gt; a4.publications.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p> 另一种姿势：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p2.article_set.remove(a5)</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[]</div><div class="line">&gt;&gt;&gt; a5.publications.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p> 关系集能够被重新指定，会清除所有现存的集合中的条目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a4.publications.all()</div><div class="line">[&lt;Publication: Science News&gt;]</div><div class="line">&gt;&gt;&gt; a4.publications = [p3]</div><div class="line">&gt;&gt;&gt; a4.publications.all()</div><div class="line">[&lt;Publication: Science Weekly&gt;]</div></pre></td></tr></table></figure></p>
<p> 关系也能够被移除：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p2.article_set.clear()</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p> 你也可以以另一种方法移除数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p2.article_set.add(a4, a5)</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[&lt;Article: NASA finds intelligent life on Earth&gt;, &lt;Article: Oxygen-free diet works wonders&gt;]</div><div class="line">&gt;&gt;&gt; a4.publications.all()</div><div class="line">[&lt;Publication: Science News&gt;, &lt;Publication: Science Weekly&gt;]</div><div class="line">&gt;&gt;&gt; a4.publications.clear()</div><div class="line">&gt;&gt;&gt; a4.publications.all()</div><div class="line">[]</div><div class="line">&gt;&gt;&gt; p2.article_set.all()</div><div class="line">[&lt;Article: Oxygen-free diet works wonders&gt;]</div></pre></td></tr></table></figure></p>
<p> 你也可以重新创建关系：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p1 = Publication(title=&apos;The Python Journal&apos;)</div><div class="line">&gt;&gt;&gt; p1.save()</div><div class="line">&gt;&gt;&gt; a2 = Article(headline=&apos;NASA uses Python&apos;)</div><div class="line">&gt;&gt;&gt; a2.save()</div><div class="line">&gt;&gt;&gt; a2.publications.add(p1, p2, p3)</div></pre></td></tr></table></figure></p>
<p> 批量删除Publication应该使用这样的办法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Publication.objects.filter(title__startswith=&apos;Science&apos;).delete()</div><div class="line">&gt;&gt;&gt; Publication.objects.all()</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; Article.objects.all()</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;, &lt;Article: NASA finds intelligent life on Earth&gt;, &lt;Article: NASA uses Python&gt;, &lt;Article: Oxygen-free diet works wonders&gt;]</div><div class="line">&gt;&gt;&gt; a2.publications.all()</div><div class="line">[&lt;Publication: The Python Journal&gt;]</div></pre></td></tr></table></figure></p>
<p> 批量删除Article应该使用这样的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; q = Article.objects.filter(headline__startswith=&apos;Django&apos;)</div><div class="line">&gt;&gt;&gt; print(q)</div><div class="line">[&lt;Article: Django lets you build Web apps easily&gt;]</div><div class="line">&gt;&gt;&gt; q.delete()</div></pre></td></tr></table></figure></p>
<p> 当删除之后，查询集中的缓存还是要清空：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; print(q)</div><div class="line">[]</div><div class="line">&gt;&gt;&gt; p1.article_set.all()</div><div class="line">[&lt;Article: NASA uses Python&gt;]</div></pre></td></tr></table></figure></p>
<p> 删除也可以使用这种方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p1.article_set = []</div><div class="line">&gt;&gt;&gt; p1.article_set.all()</div><div class="line">[]</div><div class="line"></div><div class="line">&gt;&gt;&gt; a2.publications = [p1, new_publication]</div><div class="line">&gt;&gt;&gt; a2.publications.all()</div><div class="line">[&lt;Publication: Highlights for Children&gt;, &lt;Publication: The Python Journal&gt;]</div><div class="line">&gt;&gt;&gt; a2.publications = []</div><div class="line">&gt;&gt;&gt; a2.publications.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p>多对多关系也支持一些额外的可选项，你可以在这里获得参数详情，这些可选项能够帮助定义关系工作的方式。</p>
<h3 id="其他多对多关系的字段"><a href="#其他多对多关系的字段" class="headerlink" title="其他多对多关系的字段"></a>其他多对多关系的字段</h3><p>当处理一些简单的关系的时候，标准的多对多关系完全能够胜任，然而，有些时候你还是需要在两个模型之间在数据之间确立一些关系。</p>
<p>举个例子，考虑到乐队和歌手的关系，当我们考虑到个人和团队的关系，那么毫无疑问，这是个多对多关系，但是如果要考虑到成员加入的时间的话，那么就需要仔细考虑了。</p>
<p>在这种情况下，Django允许你指定多对多关系，你可以往媒介模型之中加入额外的字段，媒介模型使用<code>through</code>的参数指明媒介来关联<code>ManyToManyField</code>，在我们的音乐家例子之中，代码应该是这样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">128</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>              <span class="comment"># __unicode__ on Python 2</span></div><div class="line">        <span class="keyword">return</span> self.name</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">128</span>)</div><div class="line">    members = models.ManyToManyField(Person, through=<span class="string">'Membership'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>              <span class="comment"># __unicode__ on Python 2</span></div><div class="line">        <span class="keyword">return</span> self.name</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Membership</span><span class="params">(models.Model)</span>:</span></div><div class="line">    person = models.ForeignKey(Person)</div><div class="line">    group = models.ForeignKey(Group)</div><div class="line">    date_joined = models.DateField()</div><div class="line">    invite_reason = models.CharField(max_length=<span class="number">64</span>)</div></pre></td></tr></table></figure></p>
<p>当你指明了媒介模型之后，你就可以精确地指定与多对多关系的外键了。这种精确地关系制订了两个模型之间的相关方式。</p>
<p>对于媒介模型，有以下的限制：</p>
<ul>
<li>你的媒介模型必须有且仅有一个到源模型的外键（在这里就是Group了）。如果你有多余一个的外键或者<code>through_fields</code>没有被指定，<code>validation error</code>就会被抛出，相同的约束也会作用于目标模板的外键（这里就是person这个模型了）</li>
<li>对于通过媒介模型建立的一个具有多对多关系的模型，这里就允许一个模型具有两个外键，但是他们仍然会被当作两个不同的多对多关系。如果有多于两个的外键，你也必须指定<code>through_fields</code>，否则也会抛出<code>validation error</code></li>
<li>当你需要定义一个从别的模型到自身的多对多关系的时候，你必须使用<code>symmetrical=False</code>（在参考里也有说明）</li>
</ul>
<p>需要指出的是，你已经使用媒介模型（也就是Membership）来建立了你的多对多模型了，你就可以开始创建一些多对多关系了，你可以通过媒介模型来创建实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; ringo = Person.objects.create(name=&quot;Ringo Starr&quot;)</div><div class="line">&gt;&gt;&gt; paul = Person.objects.create(name=&quot;Paul McCartney&quot;)</div><div class="line">&gt;&gt;&gt; beatles = Group.objects.create(name=&quot;The Beatles&quot;)</div><div class="line">&gt;&gt;&gt; m1 = Membership(person=ringo, group=beatles,</div><div class="line">...     date_joined=date(1962, 8, 16),</div><div class="line">...     invite_reason=&quot;Needed a new drummer.&quot;)</div><div class="line">&gt;&gt;&gt; m1.save()</div><div class="line">&gt;&gt;&gt; beatles.members.all()</div><div class="line">[&lt;Person: Ringo Starr&gt;]</div><div class="line">&gt;&gt;&gt; ringo.group_set.all()</div><div class="line">[&lt;Group: The Beatles&gt;]</div><div class="line">&gt;&gt;&gt; m2 = Membership.objects.create(person=paul, group=beatles,</div><div class="line">...     date_joined=date(1960, 8, 1),</div><div class="line">...     invite_reason=&quot;Wanted to form a band.&quot;)</div><div class="line">&gt;&gt;&gt; beatles.members.all()</div><div class="line">[&lt;Person: Ringo Starr&gt;, &lt;Person: Paul McCartney&gt;]</div></pre></td></tr></table></figure></p>
<p> 不同于一般的多对多关系，你不能使用<code>add</code>，<code>create</code>或者是指定的方法来创建关系：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># THIS WILL NOT WORK</div><div class="line">&gt;&gt;&gt; beatles.members.add(john)</div><div class="line"># NEITHER WILL THIS</div><div class="line">&gt;&gt;&gt; beatles.members.create(name=&quot;George Harrison&quot;)</div><div class="line"># AND NEITHER WILL THIS</div><div class="line">&gt;&gt;&gt; beatles.members = [john, paul, ringo, george]</div></pre></td></tr></table></figure></p>
<p> 为什么我们不能在Person和Group之间创建关系呢？因为你需要指定Membership中的关系详情，简单的<code>add</code>，<code>create</code>的办法不能提供这些额外的信息，所以他们就在这里被禁用了，那么创建这种关系的唯一方法就是创建媒介模型的实例了。</p>
<p>remove()这种方法也被禁用了，然而<code>clear()</code>仍然能够移除实例的所有多对多关系：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; # Beatles have broken up</div><div class="line">&gt;&gt;&gt; beatles.members.clear()</div><div class="line">&gt;&gt;&gt; # Note that this deletes the intermediate model instances</div><div class="line">&gt;&gt;&gt; Membership.objects.all()</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p> 一旦你已经通过创建媒介模型的实例来建立多对多模型了，你就可以开始查询了，和一般的多对多关系一样，你可以使用查询属性的方法来查询多对多关系。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Find all the groups with a member whose name starts with &apos;Paul&apos;</div><div class="line">&gt;&gt;&gt; Group.objects.filter(members__name__startswith=&apos;Paul&apos;)</div><div class="line">[&lt;Group: The Beatles&gt;]</div></pre></td></tr></table></figure></p>
<p>因为你已经使用了媒介模型，你也可以查询他的属性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Find all the members of the Beatles that joined after 1 Jan 1961</div><div class="line">&gt;&gt;&gt; Person.objects.filter(</div><div class="line">...     group__name=&apos;The Beatles&apos;,</div><div class="line">...     membership__date_joined__gt=date(1961,1,1))</div><div class="line">[&lt;Person: Ringo Starr]</div></pre></td></tr></table></figure></p>
<p>如果你需要访问成员的信息的话，你也可以使用这种方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; ringos_membership = Membership.objects.get(group=beatles, person=ringo)</div><div class="line">&gt;&gt;&gt; ringos_membership.date_joined</div><div class="line">datetime.date(1962, 8, 16)</div><div class="line">&gt;&gt;&gt; ringos_membership.invite_reason</div><div class="line">&apos;Needed a new drummer.&apos;</div></pre></td></tr></table></figure></p>
<p> 当然也有通过多对多反向查询的方法获取信息的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; ringos_membership = ringo.membership_set.get(group=beatles)</div><div class="line">&gt;&gt;&gt; ringos_membership.date_joined</div><div class="line">datetime.date(1962, 8, 16)</div><div class="line">&gt;&gt;&gt; ringos_membership.invite_reason</div><div class="line">&apos;Needed a new drummer.&apos;</div></pre></td></tr></table></figure></p>
<h3 id="一对一关系"><a href="#一对一关系" class="headerlink" title="一对一关系"></a>一对一关系</h3><p>为了定义对一对关系，我们可以使用<code>OneToOneField</code>，你可以像使用别的字段一样使用它。</p>
<p>当这个对象需要延伸到别的对象的时候，这个对象最有用的就是主键了。</p>
<p><code>OneToOneField</code>只有一个位置参数：相关模型的类。</p>
<p>举个例子，如果你正在创建一个位置的数据库的话，你就可能需要地址，座机号等数据。然后如果你想创建一个当地的餐馆的数据库的话，为了不重复，你就可以使Restaurant具有一个到Place的<code>OneToOneField</code>的字段（因为餐馆还是一个地方，事实上，你也可以使用继承的办法来思考这个问题，实际上也是精准的说明了一对一关系）。</p>
<p><code>OneToOneField</code>也接受一个特定的可选参数parent_link参数，<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#ref-onetoone" target="_blank" rel="external">这里</a>也有详细说明。</p>
<p><code>OneToOneField</code>这个类在以前会自动成为模型中的主键，但是现在就不会是事实了。现在你可以在一个域里面包含多个一对一的字段。</p>
<p>那么还是举个例子吧：</p>
<p>在这个例子里，一个Place可以有一个Restaurant：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">from django.db import models</div><div class="line"></div><div class="line">class Place(models.Model):</div><div class="line">    name = models.CharField(max_length=50)</div><div class="line">    address = models.CharField(max_length=80)</div><div class="line"></div><div class="line">    def __str__(self):              # __unicode__ on Python 2</div><div class="line">        return &quot;%s the place&quot; % self.name</div><div class="line"></div><div class="line">class Restaurant(models.Model):</div><div class="line">    place = models.OneToOneField(Place, primary_key=True)</div><div class="line">    serves_hot_dogs = models.BooleanField(default=False)</div><div class="line">    serves_pizza = models.BooleanField(default=False)</div><div class="line"></div><div class="line">    def __str__(self):              # __unicode__ on Python 2</div><div class="line">        return &quot;%s the restaurant&quot; % self.place.name</div><div class="line"></div><div class="line">class Waiter(models.Model):</div><div class="line">    restaurant = models.ForeignKey(Restaurant)</div><div class="line">    name = models.CharField(max_length=50)</div><div class="line"></div><div class="line">    def __str__(self):              # __unicode__ on Python 2</div><div class="line">        return &quot;%s the waiter at %s&quot; % (self.name, self.restaurant)</div></pre></td></tr></table></figure></p>
<p> 现在下面就是可以使用Python命令行来演示的例子了。</p>
<p>创建一个地点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p1 = Place(name=&apos;Demon Dogs&apos;, address=&apos;944 W. Fullerton&apos;)</div><div class="line">&gt;&gt;&gt; p1.save()</div><div class="line">&gt;&gt;&gt; p2 = Place(name=&apos;Ace Hardware&apos;, address=&apos;1013 N. Ashland&apos;)</div><div class="line">&gt;&gt;&gt; p2.save()</div></pre></td></tr></table></figure></p>
<p> 创建一个餐厅，通过“父”对象作为这个对象的id：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r = Restaurant(place=p1, serves_hot_dogs=True, serves_pizza=False)</div><div class="line">&gt;&gt;&gt; r.save()</div></pre></td></tr></table></figure></p>
<p> 通过餐厅可以访问这个地址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r.place</div><div class="line">&lt;Place: Demon Dogs the place&gt;</div></pre></td></tr></table></figure></p>
<p> p2并没有相关的餐厅的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.core.exceptions import ObjectDoesNotExist</div><div class="line">&gt;&gt;&gt; try:</div><div class="line">&gt;&gt;&gt;     p2.restaurant</div><div class="line">&gt;&gt;&gt; except ObjectDoesNotExist:</div><div class="line">&gt;&gt;&gt;     print(&quot;There is no restaurant here.&quot;)</div><div class="line">There is no restaurant here.</div></pre></td></tr></table></figure></p>
<p> 你也可以使用<code>hasattr</code>的方法来避免抛出异常：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; hasattr(p2, &apos;restaurant&apos;)</div><div class="line">False</div></pre></td></tr></table></figure></p>
<p> 使用<code>=</code>的方法来分配位置，由于Restaurant的主键是place，所以当保存的时候，新的餐厅就会被创建了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r.place = p2</div><div class="line">&gt;&gt;&gt; r.save()</div><div class="line">&gt;&gt;&gt; p2.restaurant</div><div class="line">&lt;Restaurant: Ace Hardware the restaurant&gt;</div><div class="line">&gt;&gt;&gt; r.place</div><div class="line">&lt;Place: Ace Hardware the place&gt;</div></pre></td></tr></table></figure></p>
<p> 你可以使用相反的方法来指定地点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p1.restaurant = r</div><div class="line">&gt;&gt;&gt; p1.restaurant</div><div class="line">&lt;Restaurant: Demon Dogs the restaurant&gt;</div></pre></td></tr></table></figure></p>
<p> 需要注意的是，你必须在分配一对一关系之后保存对象，举个例子，创建一个没有保存地点的餐馆就会抛出<code>ValueError</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p3 = Place(name=&apos;Demon Dogs&apos;, address=&apos;944 W. Fullerton&apos;)</div><div class="line">&gt;&gt;&gt; Restaurant.objects.create(place=p3, serves_hot_dogs=True, serves_pizza=False)</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">ValueError: save() prohibited to prevent data loss due to unsaved related object &apos;place&apos;.</div></pre></td></tr></table></figure></p>
<p> 需要指出的是，1.8-1.8.3的版本中，当上述情况发生的时候，没有保存的模型实例不会保存到相关的字段内，但是为了更简单的使用内存数据库模型这种局限性也会被移除。</p>
<p>Restaurant.objects.all()会返回Restaurant的对象，需要注意的是我们现在有两个餐厅（Ace Hardware the Restaurant是由r.place=p2所创建的）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Restaurant.objects.all()</div><div class="line">[&lt;Restaurant: Demon Dogs the restaurant&gt;, &lt;Restaurant: Ace Hardware the restaurant&gt;]</div></pre></td></tr></table></figure></p>
<p> Place.objects.all()会返回所有的Places的对象，无论其是否有餐馆：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Place.objects.order_by(&apos;name&apos;)</div><div class="line">[&lt;Place: Ace Hardware the place&gt;, &lt;Place: Demon Dogs the place&gt;]</div></pre></td></tr></table></figure></p>
<p> 你也可以通过跨关系查询的方法查询模型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Restaurant.objects.get(place=p1)</div><div class="line">&lt;Restaurant: Demon Dogs the restaurant&gt;</div><div class="line">&gt;&gt;&gt; Restaurant.objects.get(place__pk=1)</div><div class="line">&lt;Restaurant: Demon Dogs the restaurant&gt;</div><div class="line">&gt;&gt;&gt; Restaurant.objects.filter(place__name__startswith=&quot;Demon&quot;)</div><div class="line">[&lt;Restaurant: Demon Dogs the restaurant&gt;]</div><div class="line">&gt;&gt;&gt; Restaurant.objects.exclude(place__address__contains=&quot;Ashland&quot;)</div><div class="line">[&lt;Restaurant: Demon Dogs the restaurant&gt;]</div></pre></td></tr></table></figure></p>
<p> 反过来查询也是可以的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Place.objects.get(pk=1)</div><div class="line">&lt;Place: Demon Dogs the place&gt;</div><div class="line">&gt;&gt;&gt; Place.objects.get(restaurant__place=p1)</div><div class="line">&lt;Place: Demon Dogs the place&gt;</div><div class="line">&gt;&gt;&gt; Place.objects.get(restaurant=r)</div><div class="line">&lt;Place: Demon Dogs the place&gt;</div><div class="line">&gt;&gt;&gt; Place.objects.get(restaurant__place__name__startswith=&quot;Demon&quot;)</div><div class="line">&lt;Place: Demon Dogs the place&gt;</div></pre></td></tr></table></figure></p>
<p> 向Restaurant中添加一个Waitor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; w = r.waiter_set.create(name=&apos;Joe&apos;)</div><div class="line">&gt;&gt;&gt; w.save()</div><div class="line">&gt;&gt;&gt; w</div><div class="line">&lt;Waiter: Joe the waiter at Demon Dogs the restaurant&gt;</div></pre></td></tr></table></figure></p>
<p> 查询waitor：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Waiter.objects.filter(restaurant__place=p1)</div><div class="line">[&lt;Waiter: Joe the waiter at Demon Dogs the restaurant&gt;]</div><div class="line">&gt;&gt;&gt; Waiter.objects.filter(restaurant__place__name__startswith=&quot;Demon&quot;)</div><div class="line">[&lt;Waiter: Joe the waiter at Demon Dogs the restaurant&gt;]</div></pre></td></tr></table></figure></p>
<h2 id="跨文件引用模型"><a href="#跨文件引用模型" class="headerlink" title="跨文件引用模型"></a>跨文件引用模型</h2><p>很简单，只要使用类似于下面的方法就可以了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from django.db import models</div><div class="line">from geography.models import ZipCode</div><div class="line"></div><div class="line">class Restaurant(models.Model):</div><div class="line">    # ...</div><div class="line">    zip_code = models.ForeignKey(ZipCode)</div></pre></td></tr></table></figure></p>
<h2 id="字段名约束"><a href="#字段名约束" class="headerlink" title="字段名约束"></a>字段名约束</h2><p>Django只会对字段名给两个约束：</p>
<ol>
<li><p>字段名称不能使Python的保留字段，因为这样会引发Python的语法错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="keyword">pass</span> = models.IntegerField() <span class="comment"># 'pass' is a reserved word!</span></div></pre></td></tr></table></figure>
</li>
<li><p>因为Django查询方式，字段名不能包含多余一个的下划线。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span><span class="params">(models.Model)</span>:</span></div><div class="line">    foo__bar = models.IntegerField() <span class="comment"># 'foo__bar' has two underscores!</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>因为你的字段名并不是一定会匹配到你数据库的列名称，这些限制还是能够工作的。你可以在<a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.Field.db_column" target="_blank" rel="external">db_column</a>选项中获得更多信息。</p>
<p>SQL的保留字，比如<code>join</code>，<code>where</code>或者<code>select</code>是可以作为字段名的吗因为Django会编码所有的表的名称和列的名称，他会使用你数据库中的引用语法来工作。</p>
<h2 id="自定义字段类型"><a href="#自定义字段类型" class="headerlink" title="自定义字段类型"></a>自定义字段类型</h2><p>如果现有的字段不能满足你的需求的话，你可以自定义字段。你可以点击<a href="https://docs.djangoproject.com/en/1.8/howto/custom-model-fields/" target="_blank" rel="external">这里</a>获得更多自定义字段的类型。</p>
<h1 id="元选项"><a href="#元选项" class="headerlink" title="元选项"></a>元选项</h1><p>你可以使用内置的<code>Meta</code>类来描述模型的元数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">from django.db import models</div><div class="line"></div><div class="line">class Ox(models.Model):</div><div class="line">    horn_length = models.IntegerField()</div><div class="line"></div><div class="line">    class Meta:</div><div class="line">        ordering = [&quot;horn_length&quot;]</div><div class="line">        verbose_name_plural = &quot;oxen&quot;</div></pre></td></tr></table></figure></p>
<p> 模型的元数据可以是除了字段的任何的东西。比如排序，表名或者自述名。所有的都是不必须的，Meta这个类也是对于模型类的一个不必须的存在。</p>
<p>在<a href="https://docs.djangoproject.com/en/1.8/ref/models/options/" target="_blank" rel="external">这里</a>你可以获得更多元选项的详情。</p>
<h1 id="模型属性"><a href="#模型属性" class="headerlink" title="模型属性"></a>模型属性</h1><h2 id="objects"><a href="#objects" class="headerlink" title="objects"></a>objects</h2><p>一个模型最重要的属性就是<code>Manager</code>了，它也是数据库查询操作的一个接口，如果没有定义<code>Manager</code>，那么默认的名称就是<code>objects</code>了，<code>Manager</code>只能通过模型类而不是模型实例来获得。</p>
<h1 id="模型方式"><a href="#模型方式" class="headerlink" title="模型方式"></a>模型方式</h1><p>你可以通过向一个模型中自定义方法来增加一个自定义的列级别的功能。当Manager的方法能够行使表级别的事情，模型方式应该对特定模型实例做出响应。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></div><div class="line">    first_name = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    last_name = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    birth_date = models.DateField()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">baby_boomer_status</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"Returns the person's baby-boomer status."</span></div><div class="line">        <span class="keyword">import</span> datetime</div><div class="line">        <span class="keyword">if</span> self.birth_date &lt; datetime.date(<span class="number">1945</span>, <span class="number">8</span>, <span class="number">1</span>):</div><div class="line">            <span class="keyword">return</span> <span class="string">"Pre-boomer"</span></div><div class="line">        <span class="keyword">elif</span> self.birth_date &lt; datetime.date(<span class="number">1965</span>, <span class="number">1</span>, <span class="number">1</span>):</div><div class="line">            <span class="keyword">return</span> <span class="string">"Baby boomer"</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> <span class="string">"Post-boomer"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_full_name</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"Returns the person's full name."</span></div><div class="line">        <span class="keyword">return</span> <span class="string">'%s %s'</span> % (self.first_name, self.last_name)</div><div class="line">    full_name = property(_get_full_name)</div></pre></td></tr></table></figure></p>
<p>在这个例子之中最后的方法就是property。</p>
<p><a href="https://docs.djangoproject.com/en/1.8/ref/models/instances/" target="_blank" rel="external">模型实例参考</a>中有一个完全的<a href="https://docs.djangoproject.com/en/1.8/ref/models/instances/#model-instance-methods" target="_blank" rel="external">列表</a>。你可以重写<a href="https://docs.djangoproject.com/en/1.8/topics/db/models/#overriding-predefined-model-methods" target="_blank" rel="external">大多数的方法</a>，但是这里有一些你可能经常会用到的方法：</p>
<h2 id="str-（Python-3）"><a href="#str-（Python-3）" class="headerlink" title="str()（Python 3）"></a><strong>str</strong>()（Python 3）</h2><p>Python 3之中你也可以使用<code>__unicode__()</code>的方法来取代</p>
<h2 id="unicode-（Python-2）"><a href="#unicode-（Python-2）" class="headerlink" title="unicode()（Python 2）"></a><strong>unicode</strong>()（Python 2）</h2><p>python 的一个奇妙的方法就是就是返回一串使用<code>unicode</code>描述对象的字符串，这也是Python和Django会使用的。在绝大多数的情况下，在管理员站点之中，当你想要描述对象的时候，这个函数就会使用了。</p>
<p>作为开发者你还是定义这个方法比较好一点，因为默认的方法一点也不好用。。。</p>
<h2 id="get-absolute-url"><a href="#get-absolute-url" class="headerlink" title="get_absolute_url()"></a>get_absolute_url()</h2><p>这个函数会告诉Django如何去计算实例的URL，Django会在管理员界面之中使用这个函数。</p>
<p>所有具有独一无二地址的对象都需要定义这个方法。</p>
<h2 id="复写预定义的模型方法"><a href="#复写预定义的模型方法" class="headerlink" title="复写预定义的模型方法"></a>复写预定义的模型方法</h2><p>当然这里也有其他的方法来封装一系列你想自定义的数据行为。更有甚者，你需要频繁的变更<code>save()</code>和<code>delete()</code>函数的内容。</p>
<p>你可以任意的变更这种行为。</p>
<p>一个经典的方法就是在类之中内建方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    tagline = models.TextField()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        do_something()</div><div class="line">        super(Blog, self).save(*args, **kwargs) <span class="comment"># Call the "real" save() method.</span></div><div class="line">        do_something_else()</div></pre></td></tr></table></figure></p>
<p> 你也可以防止某些情形下的保存操作：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    tagline = models.TextField()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.name == <span class="string">"Yoko Ono's blog"</span>:</div><div class="line">            <span class="keyword">return</span> <span class="comment"># Yoko shall never have her own blog!</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            super(Blog, self).save(*args, **kwargs) <span class="comment"># Call the "real" save() method.</span></div></pre></td></tr></table></figure></p>
<p> 记得使用超级类的方法在开发中很重要，这就是super(Blog, self).save(<em>args, *</em>kwargs) 的活了，为了确保对象真正的保存到数据库之中，如果你忘记了，那么默认的保存操作并不会发生，数据库也不会被连接。</p>
<p>需要注意的是参数也是很重要的，Django将会延伸内建模型方法的能力，如果你需要在定义模型的时候使用<code>*args</code>和<code>**kwargs</code>，你需要保证代码会支持这些操作。</p>
<p>需要注意的是，当大规模的删除操作使用的时候，<code>delete()</code>的并不是一定需要调用的，为了确保自定义的操作逻辑被确立了，你可以使用<code>pre_delete</code>或者<code>post_delete</code>的方法。不幸的是，大规模创建或者更新对象的时候并没有<code>save()</code>，<code>pre_save</code>或者<code>post_save</code>被调用。</p>
<h1 id="执行自定义的SQL"><a href="#执行自定义的SQL" class="headerlink" title="执行自定义的SQL"></a>执行自定义的SQL</h1><p>使用原生的SQL，你可以参考文件<a href="https://docs.djangoproject.com/en/1.8/topics/db/sql/" target="_blank" rel="external">使用原生SQL</a>。</p>
<h1 id="模型的继承"><a href="#模型的继承" class="headerlink" title="模型的继承"></a>模型的继承</h1><p>在Django之中模型的继承是非常重要的，但是基本的原则仍然应该被引用。这也就是说，基础类必须具有这个<code>django.db.models.Model</code>类。</p>
<p>Django之中有三种继承方法：</p>
<ol>
<li>通常来说，你需要使用父类来容纳你并不想输出所有子类的信息，这个类并不会独立使用，所以基于抽象的类就是你需要使用的。</li>
<li>如果你需要使用一个现存的子类并且想要每个模型建立自身的表，那么多表格继承是需要的。</li>
<li>最后，如果你只需要编辑Python层面上的行为的话而不变更模型字段的话，你就可以使用<a href="https://docs.djangoproject.com/en/1.8/topics/db/models/#proxy-models" target="_blank" rel="external">代理模型</a>。</li>
</ol>
<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p>抽象类在你需要把一些常用信息放置到其他模型之中是非常有用的，你可以编写你的基类并且在Meta类之中放置<code>abstract=True</code>。这个模型并不会创建任何的数据库表。然而当基类在别的类中开始受用的时候，其字段就会在子类中显示。所以，子类和抽象类中含有相同字段就会抛出异常。</p>
<p>举个例子吧：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    age = models.PositiveIntegerField()</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        abstract = <span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(CommonInfo)</span>:</span></div><div class="line">    home_group = models.CharField(max_length=<span class="number">5</span>)</div></pre></td></tr></table></figure></p>
<p> 学生这个模型就会有三个类name,age,home_group。由于抽象基类的存在，<code>CommonInfo</code>这个模型不会视为一般的类。其不会创建一个数据表或者分配一个manager并且也不会实例化或者直接保存。</p>
<p>对于许多的用途来说，模型实例的类型会被提取。其能够提供一个基于Python层面上的常规信息的代理。</p>
<h3 id="抽象类的继承"><a href="#抽象类的继承" class="headerlink" title="抽象类的继承"></a>抽象类的继承</h3><p>当抽象基类被创建了，Django就会在你声明的基类的<code>Meta</code>中获取到一个信息。如果子类没有声明自己的基类，他就会继承父的元信息。如果子需要延伸父的元类，其就能够继承他：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        abstract = <span class="keyword">True</span></div><div class="line">        ordering = [<span class="string">'name'</span>]</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(CommonInfo)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(CommonInfo.Meta)</span>:</span></div><div class="line">        db_table = <span class="string">'student_info'</span></div></pre></td></tr></table></figure></p>
<p> Django会对抽象类调整自己的meta类：在安装了<code>Meta</code>属性之后，他就会将<code>abstract</code>置为<code>False</code>，这也意味着抽象类的子类不会自动成为子类。当然你也可以写一个继承自其他抽象类的抽象类，这样的话你需要每次都精确的置<code>abstract=True</code>。</p>
<h3 id="需要对related-name谨慎"><a href="#需要对related-name谨慎" class="headerlink" title="需要对related_name谨慎"></a>需要对related_name谨慎</h3><p>如果你对<code>ForeignKey</code>或者<code>ManyToManyField</code>使用了<code>related_name</code>属性，你需要制定一个独一无二的字段保留名。这样就会引发一个一般性的错误。</p>
<p>为了解决这个问题，当你只在抽象基类使用<code>related_name</code>的时候，你的应用名称必须包含<code>&#39;%(app_label)s&#39;</code>和<code>&#39;%(class)s&#39;</code></p>
<ul>
<li>‘%(class)s’需要有子类的小写的名称所取代</li>
<li>‘%(app_label)s’会被小写的应用名称所取代。每个安装好的应用都必须独一无二，模型类名字也需要是独二无而的</li>
</ul>
<p>举个例子，在common/models.py中分配应用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(models.Model)</span>:</span></div><div class="line">    m2m = models.ManyToManyField(OtherModel, related_name=<span class="string">"%(app_label)s_%(class)s_related"</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        abstract = <span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildA</span><span class="params">(Base)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildB</span><span class="params">(Base)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p> 当然这里还有其他的应用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> common.models <span class="keyword">import</span> Base</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildB</span><span class="params">(Base)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p> The reverse name of the <tt>common.ChildA.m2m</tt> field will be <tt>common_childa_related</tt>, whilst the reverse name of the<tt>common.ChildB.m2m</tt> field will be <tt>common_childb_related</tt>, and finally the reverse name of the <tt>rare.ChildB.m2m</tt> field will be <tt>rare_childb_related</tt>. It is up to you how you use the <tt>‘%(class)s’</tt> and <tt>‘%(app_label)s</tt> portion to construct your related name, but if you forget to use it, Django will raise errors when you perform system checks (or run <a href="https://docs.djangoproject.com/en/1.8/ref/django-admin/#django-admin-migrate" target="_blank" rel="external"><tt>migrate</tt></a>).</p>
<p>If you don’t specify a <a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.ForeignKey.related_name" title="django.db.models.ForeignKey.related_name" target="_blank" rel="external"><tt>related_name</tt></a> attribute for a field in an abstract base class, the default reverse name will be the name of the child class followed by <tt>‘_set’</tt>, just as it normally would be if you’d declared the field directly on the child class. For example, in the above code, if the <a href="https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.ForeignKey.related_name" title="django.db.models.ForeignKey.related_name" target="_blank" rel="external"><tt>related_name</tt></a> attribute was omitted, the reverse name for the <tt>m2m</tt> field would be <tt>childa_set</tt> in the<tt>ChildA</tt> case and <tt>childb_set</tt> for the <tt>ChildB</tt> field.</p>
<p>（- -翻译不下来了。。。。）</p>
<h2 id="多重继承"><a href="#多重继承" class="headerlink" title="多重继承"></a>多重继承</h2><p>由Django支持的第二种继承模型。每个模型都对应着自己的数据库表并且能够单独的查询和创建。这种继承关系会在子模型和父模型之间建立联系（通过自动创建的<code>OneToOneField</code>），举个例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Place</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    address = models.CharField(max_length=<span class="number">80</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Restaurant</span><span class="params">(Place)</span>:</span></div><div class="line">    serves_hot_dogs = models.BooleanField(default=<span class="keyword">False</span>)</div><div class="line">    serves_pizza = models.BooleanField(default=<span class="keyword">False</span>)</div></pre></td></tr></table></figure></p>
<p> 尽管数据能够归属于不同的数据库表，所有Place字段的仍然会被Restaurant所获取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; Place.objects.filter(name=&quot;Bob&apos;s Cafe&quot;)</div><div class="line">&gt;&gt;&gt; Restaurant.objects.filter(name=&quot;Bob&apos;s Cafe&quot;)</div></pre></td></tr></table></figure></p>
<p> 如果你具有一个是Restaurant和Place，你也能够使用小写版本的模型名称来获取从Place对象到Restaurant对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p = Place.objects.get(id=12)</div><div class="line"># If p is a Restaurant object, this will give the child class:</div><div class="line">&gt;&gt;&gt; p.restaurant</div><div class="line">&lt;Restaurant: ...&gt;</div></pre></td></tr></table></figure></p>
<p> 然而，如果在上面的p不是Restaurant的话，将会抛出一个<code>Restaurant.DoesNotExist</code>的异常。</p>
<h3 id="元数据和多重继承"><a href="#元数据和多重继承" class="headerlink" title="元数据和多重继承"></a>元数据和多重继承</h3><p>在多表格继承之中，子类继承父类的<code>Meta</code>类是没有意义的。所有的在父类之中应用的Meta选项可能与子选项发生矛盾。</p>
<p>所以子模型无法访问到父类的<code>Meta</code>类，然而，这里仍有一些例外：如果子类并没有指定<code>ordering</code>或者<code>get_latest_by</code>的属性的话，他就会继承父类的属性：</p>
<p>如果父类有一个ordering而你又不想子类有排序方式的话，你可以这样：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildModel</span><span class="params">(ParentModel)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        <span class="comment"># Remove parent's ordering effect</span></div><div class="line">        ordering = []</div></pre></td></tr></table></figure></p>
<h2 id="继承和保留关系"><a href="#继承和保留关系" class="headerlink" title="继承和保留关系"></a>继承和保留关系</h2><p>由于多表格继承都会使用<code>OneToOneField</code>来指明父子关系，所以在下面的例子中，子类和父类也是可以脱离的。然而，这也会使用默认的为外键和多对多字段的<code>related_name</code>。如果你把这些关系放在了父节点的子类中，你需要在每个字段里都要指定<code>related_name</code>，如果你忘记了这一点的话，Django也会抛出一个<code>Validation error</code>让你长记性的。</p>
<p>举个例子，再次使用Place这个类的时候，让我们创建另一个带有多对多字段的子类：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Supplier</span><span class="params">(Place)</span>:</span></div><div class="line">    customers = models.ManyToManyField(Place)</div></pre></td></tr></table></figure></p>
<p> 这样就会析出异常：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Reverse query name for &apos;Supplier.customers&apos; clashes with reverse query</div><div class="line">name for &apos;Supplier.place_ptr&apos;.</div><div class="line"></div><div class="line">HINT: Add or change a related_name argument to the definition for</div><div class="line">&apos;Supplier.customers&apos; or &apos;Supplier.place_ptr&apos;.</div></pre></td></tr></table></figure></p>
<p> 所以在自定义字段中需要使用<code>related_name</code>来解决这个问题：models.ManyToManyField(Place, related_name=’provider’). </p>
<h2 id="指定父链接字段"><a href="#指定父链接字段" class="headerlink" title="指定父链接字段"></a>指定父链接字段</h2><p>上面我们提到了，Django会自动创建一个<code>OneToOneField</code>来连接子类和一个不为抽象的父模型。如果你想控制连接到父模型的属性名称的话，你也可以创建一个<code>OneToOneField</code>并且设置<code>parent_link=True</code>来指明你回溯到父类的字段。</p>
<h1 id="代理模型"><a href="#代理模型" class="headerlink" title="代理模型"></a>代理模型</h1><p>当使用多表格继承中，每个模型的子类都会创建一个数据库的表。因为子类需要存储基类中无法表达的字段，所以这常常是合理的。有的时候你还是需要更改Python的模型行为：有可能是变更默认的管理器或者新增一种方法。</p>
<p>这就是代理模型做的事情了：为原始的模型创建一个代理模型，你就能创建，删除或者改变代理模型的实例，但是原始模型的数据仍然是保存好了的。不同电视你可以像变更默认模型那样在代理中修改数据而并不需要变更原始数据。</p>
<p>代理模型的声明就和一般模型一样：你可以通过在Meta类中设置<code>proxy=True</code>来达到这个目的。</p>
<p>举个例子，如果你想向Person模型中添加一种方式的话，你这样使用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></div><div class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    last_name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPerson</span><span class="params">(Person)</span>:</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        proxy = <span class="keyword">True</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment"># ...</span></div><div class="line">        <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p> MyPerson这个类就能像父类Person那样操作数据表。特殊的说，任何的Person实例都能通过MyPerson一样访问：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>p = Person.objects.create(first_name=<span class="string">"foobar"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>MyPerson.objects.get(first_name=<span class="string">"foobar"</span>)</div><div class="line">&lt;MyPerson: foobar&gt;</div></pre></td></tr></table></figure></p>
<p> 你也可以使用代理模型来定义一个不同默认的排序方式的模型，你可能并不想去指明Person模型的排序方式，但是通常来说你可以在使用代理模型的时候指定他：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderedPerson</span><span class="params">(Person)</span>:</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        ordering = [<span class="string">"last_name"</span>]</div><div class="line">        proxy = <span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p> 现在一般的Person查询仍然是无序的，但是<code>OrderedPerson</code>的查询将会按照<code>last_name</code>所排序。</p>
<h2 id="基类限制"><a href="#基类限制" class="headerlink" title="基类限制"></a>基类限制</h2><p>代理模型必须精准的继承于一个非抽象模型类，你不能由多个非抽象模型中继承，因为代理模型不会在不同表的行之间建立任何联系。代理模型可以继承于任意个抽象模型，因为他们并没有定义任何模型字段。</p>
<h2 id="代理模型管理器"><a href="#代理模型管理器" class="headerlink" title="代理模型管理器"></a>代理模型管理器</h2><p>如果你对代理模型没有指定任何模型管理器的话，它就会从父模型之中继承管理器，如果你在代理模型之中定义了管理器，那么它就会成为一个默认的管理器，然而所有在父类之中定义的管理器仍然是使用的。</p>
<p>那么接下来下面的例子，你就能在查询Person这个模型的时候变更默认管理器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewManager</span><span class="params">(models.Manager)</span>:</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPerson</span><span class="params">(Person)</span>:</span></div><div class="line">    objects = NewManager()</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        proxy = <span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p> 如果你想向代理模型中新增管理器的话，你这样在自定义管理器里所讲的这样：创建一个含有NewManager的基类，然后再基类中继承就可以了：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Create an abstract class for the new manager.</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExtraManagers</span><span class="params">(models.Model)</span>:</span></div><div class="line">    secondary = NewManager()</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        abstract = <span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPerson</span><span class="params">(Person, ExtraManagers)</span>:</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        proxy = <span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p> 你可能对这项技能不常用，但是存在即合理嘛。</p>
<h2 id="代理继承和非托管模型的区别"><a href="#代理继承和非托管模型的区别" class="headerlink" title="代理继承和非托管模型的区别"></a>代理继承和非托管模型的区别</h2><p>代理 model 继承看上去和使用<tt>Meta</tt>类中的 <a href="http://python.usyiyi.cn/django_182/ref/models/options.html#django.db.models.Options.managed" title="django.db.models.Options.managed" target="_blank" rel="external"><tt>managed</tt></a> 属性的非托管 model 非常相似。但两者并不相同，使用时选用哪种方案是一个值得考虑的问题。</p>
<p>一个不同之处是你可以在<tt>Meta.managed=False</tt>的 model 中定义字段(事实上，是必须指定，除非你真的想得到一个空 model )。在创建非托管 model 时要谨慎设置<a href="http://python.usyiyi.cn/django_182/ref/models/options.html#django.db.models.Options.db_table" title="django.db.models.Options.db_table" target="_blank" rel="external"><tt>Meta.db_table</tt></a> ，这是因为创建的非托管 model 映射某个已存在的 model ，并且有自己的方法。因此，如果你要保证这两个 model 同步并对程序进行改动，那么就会变得繁冗而脆弱。</p>
<p>另一个不同之处是两者对 管理器的处理方式不同。 代理 model 要与它所代理的 model 行为相似，所以代理 model 要继承父 model 的 managers ，包括它的默认 manager 。 但在普通的多表继承中，子类不能继承父类的 manager ，这是因为在处理非基类字段时，父类的 manager 未必适用。 后一种情况在 <a href="http://python.usyiyi.cn/django_182/topics/db/managers.html#custom-managers-and-inheritance" target="_blank" rel="external">管理器文档</a>有详细介绍。</p>
<p>我们实现了这两种特性之后，曾尝试把两者结合到一起。 结果证明，宏观的继承关系和微观的 管理器揉在一起，不仅导致 API 复杂难用，而且还难以理解。 由于任何场合下都可能需要这两个选项，所以目前二者仍是各自独立使用的。</p>
<p>所以，一般规则是：</p>
<ol>
<li>如果你要借鉴一个已有的 模型或数据表，且不想涉及所有的原始数据表的列，那就令 <tt style="line-height: 1.42857;">Meta.managed=False</tt>。通常情况下，对模型数据库创建视图和表格不需要由 Django 控制时，就使用这个选项。</li>
<li>如果你想对 model 做 Python 层级的改动，又想保留字段不变，那就令 <tt>Meta.proxy=True</tt>。因此在数据保存时，代理 model 相当于完全复制了原始 模型的存储结构。</li>
</ol>
<h2 id="多重继承-1"><a href="#多重继承-1" class="headerlink" title="多重继承"></a>多重继承</h2><p>就像Python的子类那样，DJango的模型可以继承自多个父类模型。切记一般的Python名称解析规则也会适用。出现特定名称的第一个基类(比如<a href="http://python.usyiyi.cn/django_182/topics/db/models.html#meta-options" target="_blank" rel="external">Meta</a>)是所使用的那个。例如，这意味着如果多个父类含有 <a href="http://python.usyiyi.cn/django_182/topics/db/models.html#meta-options" target="_blank" rel="external">Meta</a>类，只有第一个会被使用，剩下的会忽略掉。</p>
<p>一般来说，你并不需要继承多个父类。多重继承主要对“mix-in”类有用：向每个继承mix-in的类添加一个特定的、额外的字段或者方法。你应该尝试将你的继承关系保持得尽可能简洁和直接，这样你就不必费很大力气来弄清楚某段特定的信息来自哪里。</p>
<p>Django 1.7之前，继承多个含有<tt>id</tt>主键字段的模型不会抛出异常，但是会导致数据丢失。例如，考虑这些模型（由于<tt>id</tt>字段的冲突，它们不再有效）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></div><div class="line">    headline = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    body = models.TextField()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></div><div class="line">    title = models.CharField(max_length=<span class="number">50</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookReview</span><span class="params">(Book, Article)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p> 这段代码展示了如何创建子类的对象，并覆写之前创建的父类对象中的值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; article = Article.objects.create(headline=&apos;Some piece of news.&apos;)</div><div class="line">&gt;&gt;&gt; review = BookReview.objects.create(</div><div class="line">...     headline=&apos;Review of Little Red Riding Hood.&apos;,</div><div class="line">...     title=&apos;Little Red Riding Hood&apos;)</div><div class="line">&gt;&gt;&gt;</div><div class="line">&gt;&gt;&gt; assert Article.objects.get(pk=article.pk).headline == article.headline</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;</div><div class="line">AssertionError</div><div class="line">&gt;&gt;&gt; # the &quot;Some piece of news.&quot; headline has been overwritten.</div><div class="line">&gt;&gt;&gt; Article.objects.get(pk=article.pk).headline</div><div class="line">&apos;Review of Little Red Riding Hood.&apos;</div></pre></td></tr></table></figure></p>
<p> 你可以在模型基类中使用显式的<a href="http://python.usyiyi.cn/django_182/ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField" target="_blank" rel="external"><tt>AutoField</tt></a>来合理使用多重继承：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class Article(models.Model):</div><div class="line">    article_id = models.AutoField(primary_key=True)</div><div class="line">    ...</div><div class="line"></div><div class="line">class Book(models.Model):</div><div class="line">    book_id = models.AutoField(primary_key=True)</div><div class="line">    ...</div><div class="line"></div><div class="line">class BookReview(Book, Article):</div><div class="line">    pass</div></pre></td></tr></table></figure></p>
<p> 或者是使用一个父类来持有<a href="http://python.usyiyi.cn/django_182/ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField" target="_blank" rel="external"><tt>AutoField</tt></a>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class Piece(models.Model):</div><div class="line">    pass</div><div class="line"></div><div class="line">class Article(Piece):</div><div class="line">    ...</div><div class="line"></div><div class="line">class Book(Piece):</div><div class="line">    ...</div><div class="line"></div><div class="line">class BookReview(Book, Article):</div><div class="line">    pass</div></pre></td></tr></table></figure></p>
<h2 id="字段名hiding不被允许"><a href="#字段名hiding不被允许" class="headerlink" title="字段名hiding不被允许"></a>字段名hiding不被允许</h2><p>普通的 Python 类继承允许子类覆盖父类的任何属性。 但在 Django 中，重写 <a href="http://python.usyiyi.cn/django_182/ref/models/fields.html#django.db.models.Field" title="django.db.models.Field" target="_blank" rel="external"><tt>Field</tt></a>实例是不允许的(至少现在还不行)。如果基类中有一个 <tt>author</tt>字段，你就不能在子类中创建任何名为 <tt>author</tt>的字段。</p>
<p>重写父类的字段会导致很多麻烦，比如：初始化实例(指定在 <tt>Model.<strong>init</strong></tt> 中被实例化的字段) 和序列化。而普通的 Python 类继承机制并不能处理好这些特性。所以 Django 的继承机制被设计成与 Python 有所不同，这样做并不是随意而为的。</p>
<p>这些限制仅仅针对做为属性使用的 <a href="http://python.usyiyi.cn/django_182/ref/models/fields.html#django.db.models.Field" title="django.db.models.Field" target="_blank" rel="external"><tt>Field</tt></a>实例，并不是针对 Python 属性，Python 属性仍是可以被重写的。 在 Python 看来，上面的限制仅仅针对字段实例的名称：如果你手动指定了数据库的列名称，那么在多重继承中，你就可以在子类和某个祖先类当中使用同一个列名称。(因为它们使用的是两个不同数据表的字段)。</p>
<p>如果你在任何一个祖先类中重写了某个 model 字段，Django 都会抛出 <a href="http://python.usyiyi.cn/django_182/ref/exceptions.html#django.core.exceptions.FieldError" title="django.core.exceptions.FieldError" target="_blank" rel="external"><tt>FieldError</tt></a>异常。</p>
<p>另见</p>
<dl><dt><a href="http://python.usyiyi.cn/django_182/ref/models/index.html" target="_blank" rel="external">模型参考</a></dt><dd>涵盖模型相关的API，包括模型字段、关联对象和<tt>查询集</tt>。</dd></dl>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="kido zhang" />
          <p class="site-author-name" itemprop="name">kido zhang</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">112</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">78</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kidozh" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/331837926Ji" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                      Twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kidozh" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/kidozh" target="_blank" title="douban">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      douban
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/kidozh" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      zhihu
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 &mdash; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kido zhang</span>

  
</div>


  <div class="powered-by">
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
  </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">
    主题 &mdash;
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Pisces
    </a>
  </div>


        







        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  


  

  

</body>
</html>
