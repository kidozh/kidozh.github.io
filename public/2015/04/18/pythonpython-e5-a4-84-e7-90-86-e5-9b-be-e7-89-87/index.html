<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [Python]Python处理图片 · kidozh</title><meta name="description" content="[Python]Python处理图片 - kido zhang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://kidozh.com/atom.xml" title="kidozh"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/1793490853" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/kidozh" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">[Python]Python处理图片</h1><div class="post-info">2015年4月18日</div><div class="post-content"><p><a href="http://www.cnblogs.com/way_testlife/archive/2011/04/17/2019013.html" target="_blank" rel="external"><span style="color: black; font-family: 微软雅黑;">**<a href="/wp-content/uploads/2015/04/512733.jpg"><img src="/wp-content/uploads/2015/04/512733-1024x575.jpg" alt="" title="512733"></a>使用PIL库做图像处理<strong></strong></span></a><span style="color: #4b4b4b; font-family: 微软雅黑;"><br>**</span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">1. 简介。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">图像处理是一门应用非常广的技术，而拥有非常丰富的第三方扩展库的 Python 当然不会错过这一门盛宴。PIL （Python Imaging Library）是 Python 中最常用的图像处理库，目前版本为 1.1.7，我们可以<a href="http://www.pythonware.com/products/pil/index.htm" target="_blank" rel="external"><span style="color: black; text-decoration: underline;">在这里</span></a>下载学习和查找资料。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">Image 类是 PIL 库中一个非常重要的类，通过这个类来创建实例可以有直接载入图像文件，读取处理过的图像和通过抓取的方法得到的图像这三种方法。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">2. 使用。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    导入 Image 模块。然后通过 Image 类中的 open 方法即可载入一个图像文件。如果载入文件失败，则会引起一个 IOError ；若无返回错误，则 open 函数返回一个 Image 对象。现在，我们可以通过一些对象属性来检查文件内容，即：<br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;">1<span style="color: black;"> &gt;&gt;&gt; <span style="color: blue;">import<span style="color: black;"> Image<br><span style="color: teal;">2<span style="color: black;"> &gt;&gt;&gt; im = Image.open(<span style="color: maroon;">“j.jpg”<span style="color: black;">)<br><span style="color: teal;">3<span style="color: black;"> &gt;&gt;&gt; <span style="color: blue;">print<span style="color: black;"> im.format, im.size, im.mode<br><span style="color: teal;">4<span style="color: black;"> JPEG (440, 330) RGB<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">这里有三个属性，我们逐一了解。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">format : 识别图像的源格式，如果该文件不是从文件中读取的，则被置为 None 值。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">size : 返回的一个元组，有两个元素，其值为象素意义上的宽和高。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">mode : RGB（true color image），此外还有，L（luminance），CMTK（pre-press image）。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">现在，我们可以使用一些在 Image 类中定义的方法来操作已读取的图像实例。比如，显示最新载入的图像：<br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;">1<span style="color: black;"> &gt;&gt;&gt;im.show()<br><span style="color: teal;">2<span style="color: black;"> &gt;&gt;&gt;<br></span></span></span></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    输出原图：<br></span></p>
<p><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho1.jpg" alt=""><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3. 函数概貌。<br></span></p>
<p><span style="color: #4b4b4b; font-family: Source Code Pro; font-size: 10pt;">3.1 Reading and Writing Images : open( infilename ) , save( outfilename )<br></span></p>
<p><span style="color: #4b4b4b; font-family: Source Code Pro; font-size: 10pt;">3.2 Cutting and Pasting and Merging Images :<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">crop() : 从图像中提取出某个矩形大小的图像。它接收一个四元素的元组作为参数，各元素为（left, upper, right, lower），坐标系统的原点（0, 0）是左上角。<br></span></p>
<p><span style="color: #4b4b4b; font-family: Source Code Pro; font-size: 10pt;">paste():<br></span></p>
<p><span style="color: #4b4b4b; font-family: Source Code Pro; font-size: 10pt;">merge() :<br></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho2.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;">1<span style="color: black;"> &gt;&gt;&gt; box = (100, 100, 200, 200)<br><span style="color: teal;">2<span style="color: black;"> &gt;&gt;&gt; region = im.crop(box)<br><span style="color: teal;">3<span style="color: black;"> &gt;&gt;&gt; region.show()<br><span style="color: teal;">4<span style="color: black;"> &gt;&gt;&gt; region = region.transpose(Image.ROTATE_180)<br><span style="color: teal;">5<span style="color: black;"> &gt;&gt;&gt; region.show()<br><span style="color: teal;">6<span style="color: black;"> &gt;&gt;&gt; im.paste(region, box)<br><span style="color: teal;">7<span style="color: black;"> &gt;&gt;&gt; im.show()<br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho3.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    其效果图为：<br></span></p>
<p><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho4.jpg" alt=""><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">旋转一幅图片：<br></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho5.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;"> 1<span style="color: black;"><br><span style="color: blue;">def<span style="color: black;"> roll(image, delta):<br><span style="color: teal;"> 2<span style="color: black;"><br><span style="color: maroon;">“Roll an image sideways”<span style="color: black;"><br><span style="color: teal;"> 3</span></span></span></span></span></span></span></span></span></p>
<p><span style="color: teal;"> 4<span style="color: black;"> xsize, ysize = image.size<br><span style="color: teal;"> 5</span></span></span></p>
<p><span style="color: teal;"> 6<span style="color: black;"> delta = delta % xsize<br><span style="color: teal;"> 7<span style="color: black;"><br><span style="color: blue;">if<span style="color: black;"> delta == 0: <span style="color: blue;">return<span style="color: black;"> image<br><span style="color: teal;"> 8</span></span></span></span></span></span></span></span></span></p>
<p><span style="color: teal;"> 9<span style="color: black;"> part1 = image.crop((0, 0, delta, ysize))<br><span style="color: teal;">10<span style="color: black;"> part2 = image.crop((delta, 0, xsize, ysize))<br><span style="color: teal;">11<span style="color: black;"> image.paste(part2, (0, 0, xsize-delta, ysize))<br><span style="color: teal;">12<span style="color: black;"> image.paste(part1, (xsize-delta, 0, xsize, ysize))<br><span style="color: teal;">13</span></span></span></span></span></span></span></span></span></p>
<p><span style="color: teal;">14<span style="color: black;"><br><span style="color: blue;">return<span style="color: black;"> image<br></span></span></span></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho6.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3.3几何变换。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3.3.1简单的几何变换。<br></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho7.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;">1<span style="color: black;"> &gt;&gt;&gt;out = im.resize((128, 128)) <span style="color: green;">#<br><span style="color: teal;">2<span style="color: black;"> &gt;&gt;&gt;out = im.rotate(45) <span style="color: green;"> #逆时针旋转 45 度角。<br><span style="color: teal;">3<span style="color: black;"> &gt;&gt;&gt;out = im.transpose(Image.FLIP_LEFT_RIGHT) <span style="color: green;">#左右对换。<br><span style="color: teal;">4<span style="color: black;"> &gt;&gt;&gt;out = im.transpose(Image.FLIP_TOP_BOTTOM) <span style="color: green;">#上下对换。<br><span style="color: teal;">5<span style="color: black;"> &gt;&gt;&gt;out = im.transpose(Image.ROTATE_90) <span style="color: green;">#旋转 90 度角。<br><span style="color: teal;">6<span style="color: black;"> &gt;&gt;&gt;out = im.transpose(Image.ROTATE_180) <span style="color: green;">#旋转 180 度角。<br><span style="color: teal;">7<span style="color: black;"> &gt;&gt;&gt;out = im.transpose(Image.ROTATE_270) <span style="color: green;">#旋转 270 度角。<span style="color: black;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho8.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">各个调整之后的图像为：<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">图片1：<img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho9.jpg" alt=""><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">图片2：<img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho10.jpg" alt=""><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">图片3：<img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho11.jpg" alt=""><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">图片4：<img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho12.jpg" alt=""><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3.3.2色彩空间变换。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">convert():该函数可以用来将图像转换为不同色彩模式。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3.3.3    图像增强。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    Filters : 在 ImageFilter 模块中可以使用 filter 函数来使用模块中一系列预定义的增强滤镜。<br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;">1<span style="color: black;"> &gt;&gt;&gt; <span style="color: blue;">import<span style="color: black;"> ImageFilter<br><span style="color: teal;">2<span style="color: black;"> &gt;&gt;&gt; imfilter = im.filter(ImageFilter.DETAIL)<br><span style="color: teal;">3<span style="color: black;"> &gt;&gt;&gt; imfilter.show()<br></span></span></span></span></span></span></span></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3.4 序列图像。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">即我们常见到的动态图，最常见的后缀为 .gif ，另外还有 FLI / FLC 。PIL库对这种动画格式图也提供了一些基本的支持。当我们打开这类图像文件时，PIL 自动载入图像的第一帧。我们可以使用 seek 和 tell 方法在各帧之间移动。<br></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho13.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: teal; font-family: Microsoft YaHei Mono; font-size: 12pt;">1<span style="color: black;"><br><span style="color: blue;">import<span style="color: black;"> Image<br><span style="color: teal;">2<span style="color: black;"> im.seek(1) <span style="color: green;"># skip to the second frame<br><span style="color: teal;">3</span></span></span></span></span></span></span></span></p>
<p><span style="color: teal;">4<span style="color: black;"><br><span style="color: blue;">try<span style="color: black;">:<br><span style="color: teal;">5<span style="color: black;"><br><span style="color: blue;">while<span style="color: black;"> 1:<br><span style="color: teal;">6<span style="color: black;"> im.seek( im.tell() + 1)<br><span style="color: teal;">7<span style="color: black;"><br><span style="color: green;"># do something to im<br><span style="color: teal;">8<span style="color: black;"><br><span style="color: blue;">except<span style="color: black;"> EOFError:<br><span style="color: teal;">9<span style="color: black;"><br><span style="color: blue;">pass<span style="color: black;"><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><a href="javascript:void(0" target="_blank" rel="external"><img src="/wp-content/uploads/2015/04/041715_1702_PythonPytho14.gif" alt=""></a>; “&quot;复制代码&quot;”)<span style="color: black; font-family: 微软雅黑; font-size: 10pt;"><br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">3.5    更多关于图像文件的读取。<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    最基本的方式：im = Image.open(“filename”)<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    类文件读取：fp = open(“filename”, “rb”); im = Image.open(fp)<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    字符串数据读取：import StringIO; im = Image.open(StringIO.StringIO(buffer))<br></span></p>
<p><span style="color: #4b4b4b; font-family: 微软雅黑; font-size: 10pt;">    从归档文件读取：import TarIO; fp = TarIo.TarIO(“Image.tar”, “Image/test/lena.ppm”); im = Image.open(fp)<br></span></p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/04/18/python-e8-bd-ac-e8-bd-bdnumpy-e7-9a-84-e5-9f-ba-e6-9c-ac-e7-94-a8-e6-b3-95/" class="prev">上一篇</a><a href="/2015/04/11/acmpc2pc2-e6-89-8b-e5-86-8c/" class="next">下一篇</a></div><div class="copyright"><p>© 2013 - 2017 <a href="http://kidozh.com">kido zhang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>