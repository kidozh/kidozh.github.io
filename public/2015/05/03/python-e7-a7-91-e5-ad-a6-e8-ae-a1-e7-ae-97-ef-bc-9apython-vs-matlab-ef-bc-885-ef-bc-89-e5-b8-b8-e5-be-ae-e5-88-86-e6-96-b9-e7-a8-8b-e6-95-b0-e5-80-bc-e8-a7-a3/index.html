<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [Python] 科学计算：Python VS. MATLAB（5）----常微分方程数值解 · kidozh</title><meta name="description" content="[Python] 科学计算：Python VS. MATLAB（5）----常微分方程数值解 - kido zhang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://kidozh.com/atom.xml" title="kidozh"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/1793490853" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/kidozh" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">[Python] 科学计算：Python VS. MATLAB（5）----常微分方程数值解</h1><div class="post-info">2015年5月3日</div><div class="post-content"><p><span style="font-family:微软雅黑; font-size:14pt"><strong>一、常微分方程的一般理论</strong><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">凡含有参数，未知函数和未知函数导数 (或微分) 的方程，称为微分方程，有时简称为方程，未知函数是一元函数的微分方程称作常微分方程，未知数是多元函数的微分方程称作偏微分方程。微分方程中出现的未知函数最高阶导数的阶数，称为微分方程的阶。<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt"><strong>二、使用Python</strong><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">scipy中提供了用于解常微分方程的函数odeint()，完整的调用形式如下：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt"><strong>scipy.integrate.odeint</strong>(<strong>func, y0, t</strong>, args=(), Dfun=None, col_deriv=0, full_output=0, ml=None, mu=None, rtol=None, atol=None, tcrit=None, h0=0.0, hmax=0.0,hmin=0.0, ixpr=0, mxstep=0, mxhnil=0, mxordn=12, mxords=5, printmessg=0)<br>实际使用中，还是主要使用前三个参数，即微分方程的描写函数、初值和需要求解函数值对应的的时间点。接收数组形式。这个函数，要求微分方程必须化为标准形式，即dy/dt=f(y,t,)。而我们会发现，高阶方程的标准化工作，其实是解微分方程最主要的工作。下面是一个二阶常微分方程的例子，通过这个例子，学会变化标准形式的方法。<br>典型的二阶方程：y”+a<em>y’+b</em>y=0 ，不满足标准式。变量替换，假设输入是Y=[y,y’]，输出是Y’=[y’,y”]，那么方程就化为了Y’=F(Y,t)的形式。我们知道Y[0]=y, Y[1]=y’，所以输出形式就是：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">y’=Y[1]<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">y”=-a<em>y’-b</em>y=-a<em>Y[1]-B</em>Y[0]<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">有了这个形式，我们很容易写出Python代码：</span></p>
<p>from scipy.integrate import odeint<br>from pylab import *<br></p>
<p><span style="font-family:微软雅黑; font-size:14pt">def deriv(y,t):        # 返回值是y和y的导数组成的数组<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">    a = -2.0<br>    b = -0.1<br>    return array([ y[1], a<em>y[0]+b</em>y[1] ])<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">time = linspace(0.0,50.0,1000)<br>yinit = array([0.0005,0.2])     # 初值<br>y = odeint(deriv,yinit,time)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt"><br>figure()<br>plot(time,y[:,0],label=’y’)    #y[:,0]即返回值的第一列，是y的值。label是为了显示legend用的。<br>hold(‘on’)<br>plot(time,y[:,1],label=”y’”)     #y[:,1]即返回值的第二列，是y’的值<br>xlabel(‘t’)<br>ylabel(‘y’)<br>legend()<br>show()<br></span></p>
<p><a href="http://s14.sinaimg.cn/middle/5f234d474b9c9cf78cb7d&amp;amp;690" target="_blank" rel="external"><img src="/wp-content/uploads/2015/05/050315_0644_PythonP1.png" alt=""></a><span style="font-family:微软雅黑; font-size:14pt"><br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">——————————————————-<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt"><strong>三、使用MATLAB</strong><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">同样，MATLAB解微分方程的第一步工作也是化简微分方程为一阶的标准形式，这个和Python是完全一样的。只是函数的编写不一样。MATLAB可以在m文件函数中定义一个函数和多个子函数，但是子函数只能由同一m文件中的函数调用。并且还要求m文件名必须和主函数同名；而Python无此限制，在此可见一斑，也能看出Python代码的相对更优美。另外，Python的索引从0开始，MATLAB的从1开始，为了这个习惯，编写函数的时候也要有所注意。<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">MATLAB在这里也有一个优势，就是提供了多个求解函数，以应对时间需求、精度需求和刚性问题等要求。这就比scipy中的函数灵活了不少。如果使用scipy，只能自己编写函数了！<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">这些函数几乎统一的调用方式是：[to,yo]=solver(func,tspan,y0,options)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">其中，solver是ode45(最常用)、ode23、ode23t、ode23s、ode23tb等<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">例1：y”+4<em>y=3</em>sin(t)  y(0)=1,y’(0)=0<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">定义一个函数，描写这个微分方程：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">function dy=fun1(t,y)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">dy(1,1)=y(2)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">dy(2,1)=3<em>sin(t)-4</em>y(1)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">将这个函数存为fun1.m, 然后写一个脚本调用它，解方程。不妨这个脚本就叫做callfun1.m<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">tspan=[0,5];<br>y0=[1,0];<br>[t,y]=ode45(@fun1,tspan,y0);<br>figure;<br>plot(t,y(:,1),’k-‘);<br>hold on<br>plot(t,y(:,2),’k:’);<br>xlabel(‘t’);<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">画出来的图是这样子的：<br></span></p>
<p><a href="http://s14.sinaimg.cn/middle/5f234d474b9c9cfe9297d&amp;amp;690" target="_blank" rel="external"><img src="/wp-content/uploads/2015/05/050315_0644_PythonP2.png" alt=""></a><span style="font-family:微软雅黑; font-size:14pt"><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt"><strong>三、对比</strong><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">下面用Python实现MATLAB部分的例子。<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">from scipy.integrate import odeint<br>from pylab import *<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">#定义函数<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">def deriv(y,t):<br>    return array([ y[1], 3<em>sin(t)-4</em>y[0] ])<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">#设置初值和t区间<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">time = linspace(0.0,5.0,1000)<br>yinit = array([1,0])</span></p>
<p>#解方程并绘图<br></p>
<p><span style="font-family:微软雅黑; font-size:14pt">y = odeint(deriv,yinit,time)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">figure()<br>plot(time,y[:,0],label=’y’)<br>hold(‘on’)<br>plot(time,y[:,1],label=”y’”)<br>xlabel(‘t’)<br>ylabel(‘y’)<br>legend()<br>show()<br>结果如图，可以和MATLAB绘制出来的对比一下：<br></span></p>
<p><a href="http://s1.sinaimg.cn/middle/5f234d474b9c9d0633870&amp;amp;690" target="_blank" rel="external"><img src="/wp-content/uploads/2015/05/050315_0644_PythonP3.png" alt=""></a><span style="font-family:微软雅黑; font-size:14pt"><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">————————-<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">下面用MATLAB实现Python部分的例子。<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">函数脚本（fun1.m）：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">function dy=fun1(t,y)<br>dy(1,1)=y(2)<br>dy(2,1)=-2.0<em>y(1)-0.1</em>y(2)<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">调用脚本（callfun1.m）：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">tspan=[0,50];<br>y0=[0.0005,0.2];<br>[t,y]=ode45(@fun1,tspan,y0);<br>figure;<br>plot(t,y(:,1),’k-‘);<br>hold on<br>plot(t,y(:,2),’k:’);<br>xlabel(‘t’);<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">绘图结果：<br></span></p>
<p><a href="http://s9.sinaimg.cn/middle/5f234d474b9c9d0d7c238&amp;amp;690" target="_blank" rel="external"><img src="/wp-content/uploads/2015/05/050315_0644_PythonP4.png" alt=""></a><span style="font-family:微软雅黑; font-size:14pt"><br>        </span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">补充说明：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">MATLAB还可以使用inline的形式调用函数。比如：<br></span></p>
<p><span style="font-family:微软雅黑; font-size:14pt">tspan=[0,5];<br>y0=[1,0]<br>fun1=inline(‘[y(2);3<em>sin(t)-4</em>y(1)]’,’t’,’y’);    %注意这一句<br>[t,y]=ode45(fun1,tspan,y0);<br>figure;<br>plot(t,y(:,1),’k-‘);<br>hold on<br>plot(t,y(:,2),’k:’);<br>xlabel(‘t’);<br></span></p>
<p>这时候，不需要关心文件名的问题了，但是这种写法明显不利于推广和模块化，所以不推荐使用这样的形式。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/05/05/e5-ae-89-e5-85-a8-e5-b7-a5-e7-a8-8b-e5-bc-80-e5-9d-91-e7-af-87/" class="prev">上一篇</a><a href="/2015/05/03/python-e7-a7-91-e5-ad-a6-e8-ae-a1-e7-ae-97-ef-bc-9apython-vs-matlab-ef-bc-884-ef-bc-89-e5-9b-be-e5-bd-a2-e7-b3-bb-e7-bb-9f-e7-ae-80-e4-bb-8b/" class="next">下一篇</a></div><div class="copyright"><p>© 2013 - 2017 <a href="http://kidozh.com">kido zhang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>